<!DOCTYPE html>
<html lang="ko" data-env="production" data-analytics="on">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <!-- Google AdSense ì†Œìœ ê¶Œ í™•ì¸ ë©”íƒ€ íƒœê·¸ -->
  <meta name="google-adsense-account" content="ca-pub-6713974265397310">
  <title>RETRO RUNNER â€“ Arcade Cabinet (Fixed, Responsive)</title>

  <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
  <link rel="alternate icon" href="/favicon.ico">

  <!-- === Common SEO/A11y (auto-inserted) === -->
  <link rel="stylesheet" href="/assets/css/game-frame.css">
  <link rel="icon" href="/assets/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/icon-180.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0e1b34">
  <meta name="description" content="RETRO RUNNING â€“ Arcade Cabinet (Fixed, Responsive) | ë ˆíŠ¸ë¡œ ê°ì„± ë¯¸ë‹ˆê²Œì„ì„ ì¦ê¸°ëŠ” RETRO GAMES">
  <meta name="robots" content="index,follow">
  <meta property="og:site_name" content="RETRO GAMES">
  <meta property="og:title" content="RETRO RUNNING â€“ Arcade Cabinet (Fixed, Responsive)">
  <meta property="og:description" content="RETRO RUNNING â€“ Arcade Cabinet (Fixed, Responsive) | ë ˆíŠ¸ë¡œ ê°ì„± ë¯¸ë‹ˆê²Œì„ì„ ì¦ê¸°ëŠ” RETRO GAMES">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/assets/og/retro-games-card.png">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="RETRO RUNNING â€“ Arcade Cabinet (Fixed, Responsive)">
  <meta name="twitter:description" content="RETRO RUNNING â€“ Arcade Cabinet (Fixed, Responsive) | ë ˆíŠ¸ë¡œ ê°ì„± ë¯¸ë‹ˆê²Œì„ì„ ì¦ê¸°ëŠ” RETRO GAMES">
  <meta name="twitter:image" content="/assets/og/retro-games-card.png">

  <script>
    // fixed environment flags for analytics/runtime
    (function (d) {
      d.documentElement.dataset.env = 'production';
      d.documentElement.dataset.analytics = 'on';
      window.__ENV__ = 'production';
      window.__ANALYTICS_ON__ = true;
    })(document);

    // âœ… ê²Œì„ í˜ì´ì§€: app.jsì˜ í—¤ë”/í‘¸í„° ì˜¤í†  ì¸ì íŠ¸ë¥¼ ë¹„í™œì„±í™”í•˜ëŠ” í”Œë˜ê·¸
    window.__RG_SKIP_PARTIALS__ = true;
  </script>

  <!-- AdSense loader is centralized (partials/head-seo.html + app.js) -->

  <!-- ì „ì—­ ìœ í‹¸ -->
<script defer src="/assets/js/app.js"></script>
<script>
  // âœ… Game entry auth gate (auth first â†’ then start game)
  // - ëª©ì : "ë¡œê·¸ì¸ í™•ì¸ì´ ëë‚œ ë’¤" ê²Œì„ì´ ì‹œì‘ë˜ë„ë¡ 1íšŒ ë¦¬ë¡œë“œ ë°©ì‹ìœ¼ë¡œ ë³´ì¥
  // - ì´ìœ : ê²Œì„ ìŠ¤í¬ë¦½íŠ¸ê°€ window.load / DOMReady íƒ€ì´ë°ì— ì˜ì¡´í•´ë„ ì•ˆì „í•˜ê²Œ ì´ˆê¸°í™”ë¨
  (function () {
    const PARAM = 'rg_authed';
    const KEY = 'rg_authed_once:' + location.pathname;

    function hasAuthedParam() {
      try {
        return new URLSearchParams(location.search).get(PARAM) === '1';
      } catch {
        return false;
      }
    }

    function hasSessionFlag() {
      try {
        return sessionStorage.getItem(KEY) === '1';
      } catch {
        return false;
      }
    }

    function setSessionFlag() {
      try {
        sessionStorage.setItem(KEY, '1');
      } catch {}
    }

    function cleanUrlParam() {
      try {
        const clean = new URL(location.href);
        clean.searchParams.delete(PARAM);
        history.replaceState({}, document.title, clean.toString());
      } catch {}
    }

    async function ensureAuthThenReloadOnce() {
      try {
        const fn =
          (window.RG && typeof window.RG.requireAuth === 'function')
            ? window.RG.requireAuth
            : (typeof window.requireAuth === 'function' ? window.requireAuth : null);

        // app.jsê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê·¸ëƒ¥ í†µê³¼(ë‹¤ë§Œ ë³´í†µ load ì‹œì ì—” ë¡œë“œë¨)
        if (!fn) return;

        const ok = await fn(); // ë¹„ë¡œê·¸ì¸ì´ë©´ requireAuth ë‚´ë¶€ì—ì„œ ëª¨ë‹¬/ë¦¬ë‹¤ì´ë ‰íŠ¸ ì²˜ë¦¬
        if (ok === false) return;

        // ë¡œê·¸ì¸ í™•ì¸ ì™„ë£Œ â†’ ì´ í˜ì´ì§€ì—ì„œ 1íšŒë§Œ ë¦¬ë¡œë“œí•˜ë„ë¡ í”Œë˜ê·¸
        setSessionFlag();

        // paramì´ ì—†ìœ¼ë©´ paramì„ ë¶™ì—¬ ë¦¬ë¡œë“œ(ê²Œì„ì„ "ì§€ê¸ˆë¶€í„°" ì‹œì‘)
        if (!hasAuthedParam()) {
          const url = new URL(location.href);
          url.searchParams.set(PARAM, '1');
          location.replace(url.toString());
          return;
        }

        // paramì´ ì´ë¯¸ ìˆìœ¼ë©´(ë¦¬ë¡œë“œ í›„) URLë§Œ ì •ë¦¬
        cleanUrlParam();
      } catch (e) {
        console.warn('[RG][auth] requireAuth gate error:', e);
      }
    }

    // ì´ë¯¸ ì¸ì¦ ë¦¬ë¡œë“œë¥¼ í•œ ìƒíƒœë©´(ì„¸ì…˜ í”Œë˜ê·¸ or param) ê·¸ëƒ¥ ì§„í–‰ + param ì •ë¦¬
    if (hasAuthedParam() || hasSessionFlag()) {
      if (hasAuthedParam()) cleanUrlParam();
      return;
    }

    // app.jsê°€ deferë¼ì„œ, ì•ˆì „í•˜ê²Œ load ì´í›„ requireAuth ì‹¤í–‰
    window.addEventListener('load', function () {
      void ensureAuthThenReloadOnce();
    }, { once: true });
  })();
</script>
  <script defer src="/assets/js/analytics.js"></script>

  <!-- âœ… 2048.htmlê³¼ ë™ì¼ êµ¬ì¡° -->
  <style>
    :root {
      --cabinet:#071933;
      --cabinet2:#0b2a57;
      --bezel:#0c1e3f;
      --glow:#0ea5ff;
      --side:#f4be09;
      --btn:#133262;
      --btnBorder:#285dd1;
      --btnFg:#e9f1ff;
      --board:#121a2f;
      --tile0:#e9eef6;
      --ink:#111;
      --t2:#e7f4ff;
      --t4:#d6eaff;
      --t8:#ffe7c2;
      --t16:#ffd6a6;
      --t32:#ffc8a6;
      --t64:#ffb79c;
      --t128:#fff3a8;
      --t256:#fff09a;
      --t512:#ffeb8a;
      --t1024:#eaff9c;
      --t2048:#caffb0;
      --t4096:#b6ffd2;
      --t8192:#b2fff0;
      --touchMin:44px;
    }

    *{box-sizing:border-box}

    html,body{
      height:100%;
      margin:0;
      color:#fff;
      font-family:'Pretendard',ui-sans-serif,system-ui,"Segoe UI",Roboto,"Apple SD Gothic Neo";
      overflow:hidden;
      background:radial-gradient(circle at 40% -10%,#320076,#0b001e 70%);
    }

    /* ğŸ”¥ ë‹¤ë¥¸ CSSì—ì„œ bodyë¥¼ flexë¡œ ë§Œë“¤ì—ˆì–´ë„ ì—¬ê¸°ì„œ ê°•ì œë¡œ ë˜ëŒë¦¼ */
    body{
      display:block !important;
    }

    /* ì¤‘ì•™ ì •ë ¬ ì „ë‹´ ì»¨í…Œì´ë„ˆ */
    .shell{
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:20px;
      position:relative;
      z-index:1;
      padding-bottom:calc(20px + env(safe-area-inset-bottom,0));
    }

    /* âœ… ìœ ì € í—ˆë¸Œ(.wrap)ê°€ games/ í˜ì´ì§€ ìœ„ì— í†µì§¸ë¡œ ëœ¨ëŠ” ë¬¸ì œ ë°©ì§€ìš© */
    .wrap{display:none !important;}

    #fx{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.75}

    .shell{
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:20px;
      position:relative;
      z-index:1;
      padding-bottom:calc(20px + env(safe-area-inset-bottom,0));
    }

    /* ===== ê²Œì„ ë ˆì´ì•„ì›ƒ + ì„¸ë¡œí˜• ê´‘ê³  ë°°ë„ˆ ===== */
    .gameLayout{
      display:grid;
      grid-template-columns:160px minmax(0,1fr) 160px;
      align-items:stretch;
      gap:16px;
      width:100%;
      max-width:1500px;
      margin:0 auto;
      transform-origin:center center;
    }
    .sideAd{
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .ad-vertical{
      width:160px;
      min-height:600px;
      border-radius:16px;
      border:1px solid #2b3f8f;
      background:linear-gradient(180deg,#0b1f40,#050814);
      box-shadow:0 10px 24px rgba(0,0,0,.65),inset 0 0 18px rgba(62,142,255,.35);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:10px;
      text-align:center;
      font-size:11px;
      opacity:.95;
    }
    .ad-vertical .label{
      font-weight:900;
      margin-bottom:6px;
      color:#ffdf6e;
      letter-spacing:.12em;
    }
    .ad-vertical .hint{
      opacity:.8;
      line-height:1.4;
      margin-bottom:8px;
    }
    .ad-vertical .adsbygoogle{
      display:block;
      width:100%;
      height:100%;
    }

    /* Cabinet */
    .cabinet{
      position:relative;
      width:min(1200px,96vw);
      background:#0e1b34;
      border-radius:18px;
      box-shadow:0 12px 40px rgba(0,0,0,.65),inset 0 0 0 2px #0a1a33;
      transform-origin:top center;
    }
    .cabinet:before,
    .cabinet:after{
      content:"";
      position:absolute;
      top:12px;
      bottom:12px;
      width:18px;
      background:linear-gradient(180deg,#ffd34a,#f0b400 60%,#d99a00);
      filter:drop-shadow(0 0 12px rgba(255,190,0,.55));
    }
    .cabinet:before{left:12px;border-radius:9px}
    .cabinet:after{right:12px;border-radius:9px}

    .marquee{
      padding:18px;
      border-radius:18px 18px 0 0;
      background:linear-gradient(180deg,#173763,#0b2548);
      border-bottom:1px solid #0c2b59;
      box-shadow:inset 0 -6px 26px rgba(0,0,0,.35);
    }
    .title{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
    }
    .title h1{
      margin:0;
      font-weight:900;
      letter-spacing:2px;
      color:#eaf3ff;
      text-shadow:0 0 12px rgba(62,142,255,.55);
      font-size:clamp(18px,4.4vw,28px);
    }
    .subtitle{
      opacity:.75;
      letter-spacing:.2em;
      font-size:clamp(10px,2.7vw,12px);
      text-align:center;
    }

    /* HUD */
    .hud{
      display:flex;
      gap:12px;
      padding:12px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .chip,
    .pill,
    .hud .btnMini{
      position:relative;
      min-width:128px;
      height:46px;
      padding:0 16px;
      border-radius:14px;
      border:1px solid #1e63ff;
      color:#fff;
      font-weight:900;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      letter-spacing:.3px;
      background:
        linear-gradient(180deg,#8fe0ff 0%,#49a8ff 26%,#2f84ff 58%,#1560f2 100%),
        radial-gradient(140% 120% at 20% -40%,rgba(255,255,255,.65),rgba(255,255,255,0) 55%);
      box-shadow:0 12px 18px rgba(0,0,0,.35),
                  inset 0 1px 0 rgba(255,255,255,.5),
                  inset 0 -8px 14px rgba(0,0,0,.28);
      touch-action:manipulation;
    }
    .chip b{
      color:#fff;
      font-weight:900;
      padding-left:6px;
      text-shadow:0 1px 0 rgba(0,0,0,.25);
    }
    .pill{min-width:260px;gap:12px}
    .pill .icon{
      width:28px;
      height:28px;
      display:grid;
      place-items:center;
      border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#ffffff,#d8f1ff);
      color:#0b2a57;
      box-shadow:inset 0 -4px 8px rgba(0,0,0,.25),
                 0 0 10px rgba(255,255,255,.65);
    }
    .points .bar,
    .tickets .bar{
      height:8px;
      border-radius:999px;
      background:#1a2548;
      overflow:hidden;
      border:1px solid #2b3f8f;
      width:120px;
    }
    .points .bar>span,
    .tickets .bar>span{
      display:block;
      height:100%;
      width:0%;
      background:linear-gradient(90deg,#b86cff,#6af0ff);
      box-shadow:0 0 10px #8ad7ff;
    }
    .points .nums,
    .tickets .nums{
      display:flex;
      align-items:baseline;
      gap:8px;
      font-weight:900;
    }
    .points .nums .big,
    .tickets .nums .big{
      font-size:18px;
      color:#ffe9a3;
      text-shadow:0 0 8px #ffd86a;
    }
    .points .nums .cap,
    .tickets .nums .cap{
      opacity:.8;
      font-size:12px;
    }
    .playCount{
      font-size:12px;
      opacity:.85;
      margin-left:6px;
    }

    /* Screen */
    .play{
      position:relative;
      margin:10px 18px;
      border-radius:16px;
      background:linear-gradient(180deg,#0a1530,#031125);
      box-shadow:inset 0 0 0 1px #0b2a57,inset 0 0 60px rgba(0,0,0,.55);
    }
    .screen{
      aspect-ratio:16/9;
      display:grid;
      place-items:center;
      padding:18px;
    }
    .bezel{
      width:100%;
      height:100%;
      border-radius:14px;
      background:
        radial-gradient(120% 200% at 50% -60%,rgba(255,255,255,.07),rgba(255,255,255,0) 40%),
        linear-gradient(180deg,#0a1c39,#0a1326);
      box-shadow:inset 0 0 0 1px #132a59,inset 0 0 60px rgba(0,0,0,.65);
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
    }

    .canvasWrap{
      width:min(92%,980px);
      max-height:85%;
      display:grid;
      place-items:center;
    }

    canvas#game{
      display:block;
      width:100%;
      height:auto;
      background:#000;
      border-radius:18px;
      border:1px solid #1b2b45;
      box-shadow:inset 0 0 40px rgba(0,0,0,.25);
    }

    /* Overlay */
    .overlay{
      position:absolute;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(5,0,20,.55);
      backdrop-filter:blur(2px);
      z-index:5;
    }
    .overlay .msg{
      font-weight:900;
      letter-spacing:.2em;
      text-align:center;
      filter:drop-shadow(0 6px 20px rgba(0,0,0,.6));
      font-size:clamp(28px,5vw,68px);
      color:#ffe166;
      text-shadow:0 0 16px rgba(255,225,102,.45),
                   0 0 40px rgba(14,165,255,.25);
    }
    .overlay .sub{
      margin-top:10px;
      font-size:clamp(12px,2.2vw,16px);
      opacity:.9;
      color:#dfe9ff;
      text-align:center;
    }

    /* Deck */
    .deck{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      justify-content:center;
      padding:14px 18px 22px;
      border-top:1px solid #0a2b57;
      background:linear-gradient(180deg,#0b1f40,#0a1730);
    }
    .deck .btn,
    .deck select,
    .deck input[type=range]{
      font-weight:900;
      color:#dff1ff;
      background:linear-gradient(180deg,#1b3a7a,#102a66);
      border:1px solid #224aa8;
      border-radius:12px;
      padding:10px 14px;
      box-shadow:0 10px 18px rgba(0,0,0,.45),inset 0 0 18px rgba(255,255,255,.05);
      cursor:pointer;
      touch-action:manipulation;
    }
    .deck .btn:hover,
    .deck select:hover{
      filter:brightness(1.06);
    }
    .deck label{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .deck input[type=range]{
      width:140px;
      height:12px;
      accent-color:#5fb0ff;
    }

    /* Records Modal */
    #recModal {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(5, 0, 20, .55);
      backdrop-filter: blur(4px);
      align-items: center;
      justify-content: center;
      z-index: 999
    }

    /* Ad Modal */
    #adModal {
      display: none;
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, .65);
      backdrop-filter: blur(2px);
      align-items: center;
      justify-content: center;
      z-index: 1000
    }

    #adBox {
      width: min(680px, 92vw);
      min-height: 280px;
      border: 2px solid #3e2b7b;
      border-radius: 20px;
      box-shadow: 0 30px 60px #000a, inset 0 0 24px #2a0085;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background-image: radial-gradient(circle at 50% -60%, #1f0d48, #0c0626 70%)
    }

    #adHead {
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    #adClose {
      border: 0;
      background-color: #1b2b7a;
      color: #fff;
      border-radius: 10px;
      padding: 6px 10px;
      cursor: pointer
    }

    .adPlaceholder {
      display: grid;
      place-items: center;
      height: 220px;
      border-radius: 14px;
      border: 1px dashed #3952c3;
      background-image: linear-gradient(135deg, #18224a, #0e1636)
    }

    /* In-game Inventory HUD */
    .invHud {
      position: absolute;
      left: 12px;
      top: 12px;
      z-index: 4;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 12px;
      border: 1px solid #224aa8;
      background-image: linear-gradient(180deg, #1b3a7a, #102a66);
      box-shadow: 0 10px 18px rgba(0, 0, 0, .45), inset 0 0 18px rgba(255, 255, 255, .05);
      pointer-events: none;
    }

    .invHud .tag {
      font-weight: 900;
      letter-spacing: .03em;
      opacity: .95
    }

    .invHud .list {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 18px
    }

    .invHud .slot {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 22px;
      height: 22px
    }

    .invHud .rev {
      font-size: 14px;
      opacity: .9
    }

    .toast {
      position: absolute;
      left: 50%;
      top: 16px;
      transform: translateX(-50%);
      background: #0f1d48;
      border: 1px solid #224aa8;
      border-radius: 12px;
      padding: 8px 12px;
      font-weight: 700;
      box-shadow: 0 10px 20px #0008;
      display: none;
      z-index: 6
    }

    .touchLayer {
      position: absolute;
      inset: 0;
      display: none;
      z-index: 3;
    }
    .touchZone {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 50%;
      touch-action: none;
    }
    .tzLeft { left: 0; }
    .tzRight { right: 0; }
    .touchHint {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      opacity: .6;
      background: #0007;
      padding: 6px 10px;
      border-radius: 10px;
    }

    @media (max-width: 980px) {
      .shell {
        padding: 12px;
        padding-bottom: calc(12px + env(safe-area-inset-bottom, 0))
      }

      .cabinet {
        width: 100vw;
        border-radius: 0
      }

      .marquee {
        padding: 12px;
        border-radius: 0
      }

      .play {
        margin: 8px 12px
      }

      .screen {
        padding: 10px
      }

      .hud {
        gap: 8px;
        padding: 10px
      }

      .chip,
      .pill,
      .hud .btnMini {
        min-width: 112px;
        height: 42px;
        padding: 0 12px
      }

      .pill {
        min-width: 220px
      }

      .deck {
        gap: 8px;
        padding: 10px 12px 16px
      }

      .deck .btn,
      .deck select,
      .deck input[type=range] {
        padding: 10px 12px;
      }

      .invHud {
        left: 8px;
        top: 8px;
        transform: scale(.95);
        transform-origin: top left
      }

      .homeDisplayAd {
        min-width: 180px;
        max-width: 220px;
      }
    }

    @media (max-width: 640px) {
      .subtitle {
        letter-spacing: .08em
      }

      .hud {
        padding: 8px
      }

      .chip,
      .pill,
      .hud .btnMini {
        height: 40px
      }

      .points .nums .big,
      .tickets .nums .big {
        font-size: 16px
      }

      .points .bar,
      .tickets .bar {
        width: 96px
      }

      .deck {
        justify-content: flex-start;
        overflow: auto;
        -webkit-overflow-scrolling: touch
      }

      .deck>* {
        flex: 0 0 auto
      }

      .invHud {
        transform: scale(.9)
      }

      .homeDisplayAd {
        min-width: 140px;
        max-width: 100%;
      }
    }

    /* ===== Mobile Responsive ===== */
    @media (max-width: 1100px){
      .gameLayout{
        grid-template-columns:minmax(0,1fr);
      }
      .sideAd{
        display:none;
      }
    }

    @media (max-width: 980px){
      .shell{
        padding:12px;
        padding-bottom:calc(12px + env(safe-area-inset-bottom,0));
      }
      .cabinet{
        width:100vw;
        border-radius:0;
      }
      .marquee{
        padding:12px;
        border-radius:0;
      }
      .play{
        margin:8px 12px;
      }
      .screen{
        padding:10px;
      }
      .hud{
        gap:8px;
        padding:10px;
      }
      .chip,
      .pill,
      .hud .btnMini{
        min-width:112px;
        height:42px;
        padding:0 12px;
      }
      .pill{min-width:220px}
      .deck{
        gap:8px;
        padding:10px 12px 16px;
      }
      .deck .btn,
      .deck select,
      .deck input[type=range]{
        padding:10px 12px;
      }
    }
    @media (max-width: 640px){
      .hud{
        padding:8px;
      }
      .chip,
      .pill,
      .hud .btnMini{
        height:40px;
      }
      .points .nums .big,
      .tickets .nums .big{
        font-size:16px;
      }
      .points .bar,
      .tickets .bar{
        width:96px;
      }
      .deck{
        justify-content:flex-start;
        overflow:auto;
        -webkit-overflow-scrolling:touch;
      }
      .deck > *{
        flex:0 0 auto;
      }
    }

    .cookie-banner {
      position: fixed;
      left: 12px;
      right: 12px;
      bottom: 12px;
      display: none;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #2b3f8f;
      background: linear-gradient(180deg, #0b1f40, #0a1730);
      box-shadow: 0 10px 18px rgba(0, 0, 0, .45), inset 0 0 18px rgba(255, 255, 255, .05);
      z-index: 10000;
      font-size: 12px
    }

    .cookie-banner .spacer {
      flex: 1
    }

    .cookie-banner button {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #2d3690;
      background: linear-gradient(180deg, #1a2b7a, #0a1a64);
      font-weight: 800;
      color: #e9f0ff;
      cursor: pointer
    }

    .cookie-banner .agree {
      background: linear-gradient(180deg, #ffdf6e, #ffb84d);
      color: #3a2400;
      border-color: #7a5600
    }
  </style>
</head>

<body data-rg-skip-autoinject="1">
  <canvas id="fx"></canvas>

  <!-- ğŸµ ë°°ê²½ ìŒì•… (30% ë³¼ë¥¨, ë°˜ë³µ ì¬ìƒ) -->
<audio id="bgm" src="/assets/music/retro-running-background.mp3" preload="none" loop></audio>
  <div class="shell">
    <div class="gameLayout">
      <!-- ì¢Œì¸¡ ì„¸ë¡œ ê´‘ê³  ë°°ë„ˆ -->
      <aside class="sideAd sideAd-left" aria-label="left vertical ad">
        <div class="sideAdInner">
          <!-- ì¢Œìš°ì¸¡ ì‚¬ì´ë“œ ìˆ˜ì§í˜• ê´‘ê³  -->
          <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6713974265397310"
            data-ad-slot="4514999077" data-ad-format="auto" data-full-width-responsive="true"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
      </aside>

      <!-- ì¤‘ì•™ ì•„ì¼€ì´ë“œ ìºë¹„ë‹›(ê¸°ì¡´ ê²Œì„ UI ê·¸ëŒ€ë¡œ) -->
      <div class="game-frame">
      <section class="cabinet game-canvas" aria-label="retro arcade cabinet">
        <header class="marquee">
          <div class="title">
            <h1>RETRO RUNNING</h1>
            <div class="subtitle">SPACE/ENTER: ì‹œì‘ Â· SPACE/â†‘: ì í”„(2ë‹¨) Â· â†“: ì›…í¬ë¦¬ê¸° Â· U: ì¼ì‹œì •ì§€ Â· I: ì•„ì´í…œ</div>
          </div>
        </header>

        <!-- âœ… ê³µí†µ ê³„ì • HUD DOM (HUD ë Œë”ë§ ë¡œì§ ë‹¨ì¼í™”ìš©, ìˆ«ìëŠ” app.jsì—ì„œ data-hudë¡œ ì£¼ì…) -->
        <div id="rg-hud" class="hud-bar requires-auth">
          <span class="hud-item hud-level">
            LV. <span data-hud="level"></span>
          </span>
          <span class="hud-item hud-exp">
            EXP <span data-hud="exp"></span>
          </span>
          <span class="hud-item hud-coins">
            Coins <span data-hud="coins"></span>
          </span>
          <span class="hud-item hud-tickets">
            Tickets <span data-hud="tickets"></span>
          </span>
          <span class="hud-item hud-games">
            Plays <span data-hud="gamesPlayed"></span>
          </span>
        </div>

        <!-- HUD -->
        <div class="hud">
          <div class="chip">ì ìˆ˜ <b id="score">0</b></div>
          <div class="chip">ìµœê³  <b id="best">0</b></div>
          <div class="chip">ì´ë™ <b id="moves">0</b></div>

          <div class="pill points" aria-label="ì‚¬ìš©ì í¬ì¸íŠ¸">
            <div class="icon">ğŸ…</div>
            <div>
              <div class="nums">
                <span class="big" id="pointsAmt">0</span>
                <span class="cap">/ <span id="pointsCap">5,000</span></span>
              </div>
              <div class="bar"><span id="pointsBar"></span></div>
            </div>
          </div>

          <div class="pill tickets" aria-label="í‹°ì¼“ ì§„í–‰">
            <div class="icon">ğŸŸï¸</div>
            <div>
              <div class="nums"><span class="big" id="ticketsAmt">0</span><span class="cap">í‹°ì¼“</span></div>
              <div class="bar"><span id="ticketsBar"></span></div>
            </div>
            <div class="playCount" id="ticketsCap">0 / 10</div>
          </div>

          <button class="btnMini" id="recordsBtn" aria-label="ë‚´ ê²Œì„ ê¸°ë¡">MY RECORDS</button>
        </div>

        <main class="play">
          <div class="screen">
            <div class="bezel">
              <div class="invHud" aria-label="ì¸ê²Œì„ ì•„ì´í…œ">
                <div class="tag">ğŸ’ ITEMS</div>
                <div id="invHudList" class="list" aria-live="polite"></div>
              </div>

              <div id="toast" class="toast" role="status" aria-live="polite"></div>

              <div class="canvasWrap" id="canvasWrap">
                <div class="game-frame">
                  <div class="game-canvas">
                    <canvas id="game"></canvas>
                  </div>
                </div>
                <div class="touchLayer" id="touchLayer" aria-hidden="true">
                  <div class="touchZone tzLeft" id="tzLeft"></div>
                  <div class="touchZone tzRight" id="tzRight"></div>
                  <div class="touchHint">ì¢Œì¸¡: ëˆ„ë¥´ë©´ ì›…í¬ë¦¬ê¸° / ìš°ì¸¡: íƒ­=ì í”„, ë”ë¸”íƒ­=ì‹œì‘/ì¬ì‹œì‘</div>
                </div>
              </div>

              <div id="gameOver" class="overlay" aria-live="polite" role="alert">
                <div>
                  <div class="msg">GAME OVER</div>
                  <div class="sub">N/Enter/Space: ìƒˆ ê²Œì„ Â· U: ì¼ì‹œì •ì§€/ì¬ê°œ Â· SPACE/â†‘: ì í”„</div>
                </div>
              </div>
            </div>
          </div>
        </main>

        <!-- âœ… AdSense ìµœì†Œ í†µê³¼ìš©: ê²Œì„ ì•ˆë‚´(í…ìŠ¤íŠ¸/êµ¬ì¡°) -->
        <section class="content-guide" aria-label="RETRO RUNNER ê²Œì„ ì•ˆë‚´">
          <h1>RETRO RUNNER â€“ ëŸ¬ë‹ ì•¡ì…˜</h1>
          <p>RETRO RUNNERëŠ” ì¥ì• ë¬¼ì„ ì í”„/íšŒí”¼í•˜ë©° ê°€ëŠ¥í•œ ì˜¤ë˜ ë‹¬ë¦¬ëŠ” ëŸ¬ë‹ ì•¡ì…˜ ê²Œì„ì…ë‹ˆë‹¤. ì•„ë˜ ì•ˆë‚´ëŠ” í”Œë ˆì´ ê·œì¹™, ì¡°ì‘, ë³´ìƒ/ì €ì¥ ë°©ì‹ì„ ëª…í™•íˆ ì œê³µí•˜ê¸° ìœ„í•œ í…ìŠ¤íŠ¸ ì˜ì—­ì…ë‹ˆë‹¤.</p>

          <h2>ê²Œì„ ê·œì¹™</h2>
          <ul>
            <li>ì¥ì• ë¬¼ì„ í”¼í•˜ë©° ë‹¬ë¦° ì‹œê°„ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì ìˆ˜ê°€ ìƒìŠ¹í•©ë‹ˆë‹¤.</li>
            <li>ì¶©ëŒí•˜ê±°ë‚˜ ì‹¤íŒ¨ ì¡°ê±´ì„ ë§Œì¡±í•˜ë©´ ê²Œì„ì´ ì¢…ë£Œë©ë‹ˆë‹¤.</li>
            <li>ì•„ì´í…œì´ ì¡´ì¬í•  ê²½ìš° ì¼ì‹œì  ê°•í™”/ë³´ì¡° íš¨ê³¼ê°€ ì ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
          </ul>

          <h2>ì¡°ì‘ ë°©ë²•</h2>
          <ul>
            <li>ì í”„/í–‰ë™: Space ë˜ëŠ” ì§€ì • í‚¤(í˜ì´ì§€ ì•ˆë‚´ ê¸°ì¤€)</li>
            <li>ì›…í¬ë¦¬ê¸°/íšŒí”¼: â†“ ë˜ëŠ” ì§€ì • í‚¤(í˜ì´ì§€ ì•ˆë‚´ ê¸°ì¤€)</li>
          </ul>

          <h2>ë³´ìƒ/ì €ì¥</h2>
          <p>í”Œë ˆì´ ê²°ê³¼ì— ë”°ë¼ EXPÂ·í¬ì¸íŠ¸Â·í‹°ì¼“ ë³´ìƒì´ ì§€ê¸‰ë  ìˆ˜ ìˆìœ¼ë©°, ì§€ê¸‰ëœ ìì›ì€ ë¡œê·¸ì¸ ê³„ì •ì— ì €ì¥ë©ë‹ˆë‹¤. ëˆ„ì  ìì›ì€ <a href="/user-retro-games.html">ìœ ì € í—ˆë¸Œ</a>ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>

          <div class="mini">
            <p>ê´€ë ¨ ë¬¸ì„œ: <a href="/about.html">ì†Œê°œ</a> Â· <a href="/help.html">ë„ì›€ë§</a> Â· <a href="/legal/terms.html">ì´ìš©ì•½ê´€</a> Â· <a href="/legal/privacy.html">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a></p>
          </div>
        </section>

        <!-- Control deck -->
        <div class="deck">
          <button class="btn" id="homeBtn">HOME</button>

          <!-- í™ˆë²„íŠ¼ ì‚¬ê°í˜• ë””ìŠ¤í”Œë ˆì´ ê´‘ê³  -->
          <div class="homeDisplayAd" aria-label="home button display ad">
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6713974265397310"
              data-ad-slot="7668007538" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>
              (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
          </div>

          <button class="btn" id="newBtn">ìƒˆ ê²Œì„ (N / Enter / Space)</button>
          <button class="btn" id="undoBtn">ì¼ì‹œì •ì§€/ì¬ê°œ (U)</button>
          <label>ëª¨ë“œ
            <select id="tier">
              <option value="beginner">ì´ˆê¸‰ (1â€“10)</option>
              <option value="intermediate">ì¤‘ê¸‰ (11â€“20)</option>
              <option value="advanced">ê³ ê¸‰ (21â€“30)</option>
              <option value="hell">ì§€ì˜¥ (40)</option>
              <option value="doom">íŒŒë©¸ (50)</option>
              <option value="insane">ê·¹ì•…ë¬´ë„ (100)</option>
            </select>
          </label>
          <label>ë ˆë²¨
            <input id="lvlRange" type="range" min="1" max="100" value="1" step="1">
          </label>
          <label>ë³´ë“œ
            <select id="sizeSel" disabled>
              <option value="12" selected>ê³ ì •</option>
            </select>
          </label>
          <button class="btn" id="endBtn">ê²Œì„ ì¢…ë£Œ</button>
        </div>
      </section>

      <!-- ìš°ì¸¡ ì„¸ë¡œ ê´‘ê³  ë°°ë„ˆ -->
      <aside class="sideAd sideAd-right" aria-label="right vertical ad">
        <div class="sideAdInner">
          <!-- ì¢Œìš°ì¸¡ ì‚¬ì´ë“œ ìˆ˜ì§í˜• ê´‘ê³  -->
          <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-6713974265397310"
            data-ad-slot="4514999077" data-ad-format="auto" data-full-width-responsive="true"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
      </aside>
    </div>
  </div>

  <!-- Records Modal -->
  <div id="recModal">
    <div
      style="width:min(640px,94vw);border:2px solid #3e2b7b;border-radius:20px;box-shadow:0 30px 60px #000a,inset 0 0 24px #2a0085;padding:22px; background-image:radial-gradient(circle at 50% -60%,#1f0d48,#0c0626 70%);">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 style="margin:0;color:#ffdf6e">ë‚´ ê²Œì„ ê¸°ë¡</h3>
        <button id="recClose"
          style="border:0;background-color:transparent;color:#fff;font-size:22px;cursor:pointer">Ã—</button>
      </div>
      <div id="recBody"
        style="max-height:60vh;overflow:auto;border:1px solid #2a3a89;border-radius:12px;padding:8px"></div>
    </div>
  </div>

  <!-- Ad Modal -->
  <div id="adModal" role="dialog" aria-modal="true" aria-labelledby="adTitle">
    <div id="adBox">
      <div id="adHead">
        <h3 id="adTitle" style="margin:0;color:#ffdf6e">ê´‘ê³ </h3>
        <button id="adClose">ë‹«ê¸°</button>
      </div>
      <div id="adContainer" class="adPlaceholder">
        <div style="text-align:center;opacity:.9">
          <div style="font-weight:900;margin-bottom:6px">ì—¬ê¸°ì— ê´‘ê³ ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
          <div style="font-size:12px;opacity:.8">ê°œë°œ/í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” í”Œë ˆì´ìŠ¤í™€ë”ê°€ ë³´ì…ë‹ˆë‹¤</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /***** AdSense ì—°ë™ (í´ë¼ì´ì–¸íŠ¸ ID ì •í•© + ìŠ¬ë¡¯ ë¶„ë¦¬) *****/
    const AD_CLIENT = 'ca-pub-6713974265397310'; // âœ… ë©”íƒ€ íƒœê·¸ì™€ ë™ì¼í•˜ê²Œ ì •í•©
    const AD_SLOT = window.RG_AD_SLOT || '7668007538';

    function fallbackAdHTML() {
      return '<div class="adPlaceholder" style="height:220px;display:grid;place-items:center"><div style="text-align:center"><div style="font-weight:900;margin-bottom:6px">Ad Placeholder</div><div style="font-size:12px;opacity:.8">AdSense ì„¤ì • í›„ ì‹¤ì œ ê´‘ê³ ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div></div></div>';
    }
    function showInterstitialAd() {
      const box = document.getElementById('adContainer');
      if (!box) return;
      box.innerHTML = '';
      const ins = document.createElement('ins');
      ins.className = 'adsbygoogle';
      ins.style.display = 'block';
      ins.setAttribute('data-ad-client', AD_CLIENT);
      if (AD_SLOT) {
        ins.setAttribute('data-ad-slot', AD_SLOT);
      }
      ins.setAttribute('data-ad-format', 'auto');
      ins.setAttribute('data-full-width-responsive', 'true');
      box.appendChild(ins);
      try {
        (window.adsbygoogle = window.adsbygoogle || []).push({});
      } catch (e) {
        console.warn(e);
        box.innerHTML = fallbackAdHTML();
      }
      document.getElementById('adModal').style.display = 'flex';
    }
    let _afterAd = null;
    function showAdThen(fn) {
      _afterAd = (typeof fn === 'function') ? fn : null;
      showInterstitialAd();
    }
    document.getElementById('adClose').addEventListener('click', () => {
      document.getElementById('adModal').style.display = 'none';
      const f = _afterAd;
      _afterAd = null;
      if (f) try { f(); } catch (e) { console.error(e); }
    });

    /***** Neon FX *****/
    (function () {
      const c = document.getElementById('fx'); if (!c) return;
      const g = c.getContext('2d');
      function fit() {
        const d = window.devicePixelRatio || 1;
        c.width = innerWidth * d;
        c.height = innerHeight * d;
        g.setTransform(d, 0, 0, d, 0, 0);
      }
      fit();
      addEventListener('resize', fit, { passive: true });
      const N = 80;
      const pts = new Array(N).fill(0).map(() => ({
        x: Math.random() * innerWidth,
        y: Math.random() * innerHeight * 0.9,
        r: Math.random() * 2 + 0.5,
        s: Math.random() * 0.6 + 0.2,
        ph: Math.random() * 6.283
      }));
      function loop(t) {
        g.clearRect(0, 0, c.width, c.height);
        for (const p of pts) {
          g.beginPath();
          g.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          const a = 0.3 + Math.sin(t * 0.002 + p.ph) * 0.25;
          g.fillStyle = 'rgba(43,123,255,' + a + ')';
          g.fill();
          p.y += p.s;
          if (p.y > innerHeight) {
            p.y = -10;
            p.x = Math.random() * innerWidth;
          }
        }
        requestAnimationFrame(loop);
      }
      requestAnimationFrame(loop);
    })();

    /***** Helpers & Storage *****/
    const $ = sel => document.querySelector(sel);
    const DPR = () => Math.min(2, window.devicePixelRatio || 1);
    const clamp = (n, a, b) => Math.max(a, Math.min(b, n));
    const fmt = n => n.toLocaleString('ko-KR');
    const todayKey = () => new Date().toISOString().slice(0, 10);

    /* âœ… Runner ì „ìš© ìŠ¤í† ë¦¬ì§€ í‚¤ */
    // âœ… ìœ ì €ë³„ localStorage prefix (A/B ìœ ì € ë¶„ë¦¬)
    const __RG_LS_PREFIX = (() => {
      try {
        const token = localStorage.getItem("rg_jwt_token") || "";
        const part = token.split(".")[1] || "";
        if (!part) return "rg_guest_";
        const b64 = part.replace(/-/g, "+").replace(/_/g, "/") + "===".slice((part.length + 3) % 4);
        const json = JSON.parse(decodeURIComponent(escape(atob(b64))));
        const sub = String(json.sub || "").trim();
        return sub ? `rg_u_${sub}_` : "rg_guest_";
      } catch (e) {
        return "rg_guest_";
      }
    })();

    const LS_KEYS = {
      plays: __RG_LS_PREFIX + 'plays_runner',
      tickets: __RG_LS_PREFIX + 'tickets_runner',
      records: __RG_LS_PREFIX + 'records_runner',
      best: __RG_LS_PREFIX + 'best_runner',
      mission: __RG_LS_PREFIX + 'daily_mission_flags',
      missionRewarded: __RG_LS_PREFIX + 'daily_mission_rewarded'
    };

    function loadJSON(k, def) {
      try {
        const v = localStorage.getItem(k);
        return v ? JSON.parse(v) : def;
      } catch (e) { return def; }
    }
    function saveJSON(k, v) { localStorage.setItem(k, JSON.stringify(v)); }

    function updateTicketUI() {
      const plays   = +localStorage.getItem(LS_KEYS.plays)   || 0;
      const tickets = +localStorage.getItem(LS_KEYS.tickets) || 0;

      const amt = document.getElementById('ticketsAmt');
      const cap = document.getElementById('ticketsCap');
      const bar = document.getElementById('ticketsBar');

      if (amt) amt.textContent = tickets;
      if (cap) cap.textContent = (plays % 10) + ' / 10';
      if (bar) bar.style.width = (((plays % 10) / 10 * 100).toFixed(1)) + '%';
    }

    /***** 3íšŒë‹¹ 1íšŒ ê´‘ê³  ë…¸ì¶œ + í‹°ì¼“ ì ë¦½ *****/
    function addPlay() {
      let plays = +localStorage.getItem(LS_KEYS.plays) || 0;
      plays++;
      let tickets = +localStorage.getItem(LS_KEYS.tickets) || 0;
      if (plays % 10 === 0) tickets++;
      localStorage.setItem(LS_KEYS.plays, String(plays));
      localStorage.setItem(LS_KEYS.tickets, String(tickets));
      updateTicketUI();
      // ğŸ” 3íšŒ í”Œë ˆì´ë§ˆë‹¤ ì¸í„°ìŠ¤í‹°ì…œ ê´‘ê³ 
      if (plays % 3 === 0) { showInterstitialAd(); }
    }

    /***** Toast *****/
    function showToast(msg, ms = 2000) {
      const t = $('#toast'); if (!t) return;
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(() => { t.style.display = 'none'; }, ms);
    }

    /***** ğŸµ Background Music (30% volume, loop) *****/
    let bgmAudio = null;
    function initBgm() {
      try {
        const el = document.getElementById('bgm');
        if (!el) return;
        bgmAudio = el;
        bgmAudio.volume = 0.3;
      } catch (e) {
        console.warn('bgm init error', e);
      }
    }
    function playBgm() {
      if (!bgmAudio) initBgm();
      if (!bgmAudio) return;
      try {
        const p = bgmAudio.play();
        if (p && typeof p.catch === 'function') {
          p.catch(() => { /* autoplay block ë¬´ì‹œ */ });
        }
      } catch (e) { /* no-op */ }
    }
    function pauseBgm() {
      try {
        if (bgmAudio) bgmAudio.pause();
      } catch (e) { }
    }
    initBgm();

    /***** ë‚œì´ë„ ê³„ìˆ˜ (HUD/ë³´ìƒ ê³µí†µ) *****/
    function difficultyMult() {
      const val = $('#tier')?.value || 'beginner';
      return {
        beginner: 1.00,
        intermediate: 1.15,
        advanced: 1.35,
        hell: 1.50,
        doom: 1.65,
        insane: 1.85
      }[val] || 1.0;
    }

    /***** í—ˆë¸Œ ë™ê¸°í™” ìŠ¤í… (í˜„ì¬ í˜ì´ì§€ì—ì„œëŠ” ë³„ë„ ë™ê¸°í™” ì—†ìŒ) *****/
    function RG_syncWalletHUD() {
      // í—ˆë¸Œ(user-retro-games.html)ì—ì„œ í†µí•© ì›”ë › ìƒíƒœë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ,
      // ê²Œì„ í˜ì´ì§€ì—ì„œëŠ” ë³„ë„ ì´ˆê¸° ë™ê¸°í™” ì—†ì´ ë³´ìƒ ì ë¦½ ì‹œì ì—ë§Œ ì—°ë™.
    }

    /***** ğŸ”— ì „ì—­ í—ˆë¸Œ ë³´ìƒ ì—°ë™ í—¬í¼ (sendGameReward / refreshWalletHUD ì‚¬ìš©) *****/
    async function applyGlobalRewardAndSyncWallet(gameId, delta, meta){
      const d = delta || {};
      const m = meta  || {};

      const score =
        (typeof m.score === 'number') ? m.score :
        (typeof d.score === 'number') ? d.score : 0;

      const RUNKEY  = `rg:${gameId}:activeRunId`;
      const LASTKEY = `rg:${gameId}:lastFinish`;

      let runId = m.runId || sessionStorage.getItem(RUNKEY);
      if(!runId){
        try{
          const last = JSON.parse(sessionStorage.getItem(LASTKEY) || "null");
          if(last && last.runId && (Date.now() - (last.ts||0) < 15000)) runId = last.runId;
        }catch(e){}
      }
      if(!runId){
        runId = (gameId + ":" + Date.now() + ":" + Math.random().toString(16).slice(2));
        sessionStorage.setItem(RUNKEY, runId);
      }

      const IDEMKEY = `rg:${gameId}:rewarded:${runId}`;
      if(sessionStorage.getItem(IDEMKEY) === "1") return null;
      sessionStorage.setItem(IDEMKEY, "1");

      try{
        const payload = {
          exp: Number(d.xp || d.exp || 0),
          tickets: Number(d.tickets || 0),
          points: Number(d.coins || d.points || 0),
          score: Number(score) || 0,
          meta: Object.assign({}, m || {}, { runId })
        };

        const data =
          (typeof window.sendGameReward === "function")
            ? await window.sendGameReward(String(gameId), payload)
            : null;

        if(!data || data.success !== true){
          sessionStorage.removeItem(IDEMKEY);
          throw new Error((data && data.error) ? data.error : "reward_failed");
        }

        sessionStorage.setItem(LASTKEY, JSON.stringify({ runId, ts: Date.now() }));
        if(sessionStorage.getItem(RUNKEY) === runId) sessionStorage.removeItem(RUNKEY);

        const snap = data.snapshot || null;
        if(snap && typeof window.applyAccountApiResponse === "function"){
          window.applyAccountApiResponse(snap);
        }else if(typeof window.refreshWalletHUD === "function"){
          window.refreshWalletHUD();
        }

        return data;
      }catch(e){
        console.warn(`[${gameId}] finish sync failed:`, e);
        try{
          if(typeof window.RG_queueReward === "function"){
            window.RG_queueReward({
              gameId,
              score: Number(score)||0,
              coins: Number(d.coins||0),
              tickets: Number(d.tickets||0),
              xp: Number(d.xp||0),
              meta: m || {}
            });
          }
        }catch(_e){}
        return null;
      }
    }

    /***** RETRO RUNNING (ê²Œì„) *****/
    (function () {
      function paramsForLevel(lv) {
        var startSpd = 280 + lv * 5.5;
        var maxSpd = 520 + lv * 6.5;
        var accel = 10 + lv * 0.35;
        var gravity = 2000 + lv * 8;
        var jumpVy = -(760 + lv * 2.5);
        var spawnMin = Math.max(320, 900 - lv * 7);
        var birdRate = (lv < 20) ? 0 : Math.min(0.5, (lv - 18) * 0.02);
        var flock = lv >= 40 ? Math.min(0.45, (lv - 35) * 0.01) : 0;
        var nightSec = lv >= 30 ? clamp(22 - (lv - 30) * 0.2, 10, 22) : 9999;
        var lowGap = clamp(80 - lv * 0.3, 42, 80);
        return { startSpd, maxSpd, accel, gravity, jumpVy, spawnMin, birdRate, flock, nightSec, lowGap };
      }

      var SFX = (function () {
        var ctx;
        function ensure() { return ctx || (ctx = new (window.AudioContext || window.webkitAudioContext)()); }
        function beep(f, d, t, g) {
          f = f || 880; d = d || 0.05; t = t || 'square'; g = g || 0.06;
          var ac = ensure(); var o = ac.createOscillator(); var gn = ac.createGain();
          o.type = t; o.frequency.value = f; gn.gain.value = g;
          o.connect(gn); gn.connect(ac.destination);
          var now = ac.currentTime;
          o.start(now); o.stop(now + d);
          gn.gain.setTargetAtTime(0, now + d * 0.6, 0.03);
        }
        return {
          milestone: () => beep(1200, 0.07, 'square', 0.07),
          hit: () => beep(700, 0.04, 'square', 0.05),
          step: () => beep(500, 0.02, 'square', 0.02),
          pickup: () => beep(900, 0.05, 'square', 0.05)
        };
      })();

      class Dino {
        constructor(canvas) {
          this.c = canvas;
          this.ctx = canvas.getContext('2d');
          this.buf = document.createElement('canvas');
          this.bctx = this.buf.getContext('2d');
          this.logicalW = 800;
          this.logicalH = 300;
          this.buf.width = this.logicalW;
          this.buf.height = this.logicalH;

          this.groundY = 244;
          this.reset(1);
          this.bind();
          this.resize();
          this.loop();
          requestAnimationFrame(() => this.resize());

          /* âœ… ì„¸ì…˜ ì‹œì‘ ì•Œë¦¼ */
          notifyStart();
        }

        reset(level) {
          this.level = level || 1;
          this.p = paramsForLevel(this.level);

          // âœ… ì ìˆ˜ ê¸°ë°˜ ì†ë„ ì¦ê°€ ê¸°ë³¸ê°’
          this.baseStartSpd = this.p.startSpd;
          this.scoreSpeedStep = 200;           // 200ì ë§ˆë‹¤ í•œ ë‹¨ê³„
          this.scoreSpeedBonusPerStep = 12;    // ë‹¨ê³„ë‹¹ ì†ë„ ë³´ë„ˆìŠ¤
          this.scoreSpeedBonusMax = 120;       // ìµœëŒ€ ì¶”ê°€ ë³´ë„ˆìŠ¤

          this.spd = this.p.startSpd;
          this.t = 0;
          this.nextSpawn = 0;
          this.dayT = 0;
          this.isNight = false;
          this.milestoneScoreNext = 100;
          this.boostT = 2.0;

          this.score = 0;
          this.best = +(localStorage.getItem(LS_KEYS.best) || 0);
          this.running = false;
          this.paused = false;
          this.gameover = false;

          this.player = {
            x: 60,
            y: this.groundY,
            vy: 0,
            w: 44,
            h: 48,
            duck: false,
            runT: 0,
            blinkT: this.rand(2, 7),
            jumps: 0,
            maxJumps: 2
          };
          this.objs = [];
          this.items = [];
          this.clouds = this.makeClouds();
          this.fx = [];

          this.inv = [];
          this.revive = 0;
          this.itemInvT = 0;
          this.itemSpeedMult = 1;
          this.itemInvActive = false;

          this.points = 0;
          this.pointsCap = 5000;

          this.avoided = 0;
          this.combo = 0;

          this.syncHUD(true);
          this.updatePointsUI();
          this.renderInvUI();
          $('#gameOver').style.display = 'none';
        }

        rand(a, b) { return a + Math.random() * (b - a); }

        makeClouds() {
          var arr = [];
          for (var i = 0; i < 6; i++)
            arr.push({ x: this.rand(0, this.logicalW), y: this.rand(20, 90), sp: this.rand(10, 20) });
          return arr;
        }

        bind() {
          window.addEventListener('resize', () => this.resize(), { passive: true });

          $('#newBtn').addEventListener('click', () => this.startOrRestart());
          $('#undoBtn').addEventListener('click', () => {
            if (this.running && !this.gameover) this.paused = !this.paused;
          });
          $('#endBtn').addEventListener('click', () => showAdThen(() => this.doGameOver(true)));

          // âœ… HOME: ê´‘ê³  í›„, ë¡œê·¸ì¸ í—ˆë¸Œ(user-retro-games.html)ë¡œ ì´ë™
          $('#homeBtn').addEventListener('click', () =>
            showAdThen(() => window.location.href = '/user-retro-games.html')
          );

          const tier = $('#tier'), lvl = $('#lvlRange');
          const applyTier = (t) => {
            let lv = {
              beginner: 1,
              intermediate: 11,
              advanced: 21,
              hell: 40,
              doom: 50,
              insane: 100
            }[t] || 1;
            lvl.value = lv;
            this.setLevel(lv);
          };
          tier.addEventListener('change', () => applyTier(tier.value));
          lvl.addEventListener('input', () => this.setLevel(+lvl.value));

          document.addEventListener('keydown', (e) => {
            if ((e.code === 'ArrowUp' || e.code === 'ArrowDown') && document.activeElement?.type === 'range') {
              document.activeElement.blur();
            }

            if (e.code === 'Enter' || e.code === 'KeyN') {
              this.startOrRestart();
            }
            if (e.code === 'Space') {
              if (!this.running || this.gameover) {
                this.startOrRestart();
              } else if (this.paused) {
                this.paused = false;
              } else {
                this.jump(true);
              }
              e.preventDefault();
            }
            if (e.code === 'ArrowUp') {
              if (this.running && !this.paused && !this.gameover) this.jump(true);
              else if (!this.running || this.gameover) this.startOrRestart();
              e.preventDefault();
            }
            if (e.code === 'ArrowDown') {
              if (!this.gameover) this.player.duck = true;
            }
            if (e.code === 'KeyU') {
              if (this.running && !this.gameover) this.paused = !this.paused;
            }
            if (e.code === 'KeyI') {
              this.useNextItem();
            }
          });

          document.addEventListener('keyup', (e) => {
            if (e.code === 'ArrowDown') this.player.duck = false;
          });

          /* í„°ì¹˜ ì¡°ì‘ */
          const tzL = $('#tzLeft'), tzR = $('#tzRight');
          if (tzL && tzR) {
            let lastTap = 0, duckTouchId = null;

            const onLStart = (e) => {
              e.preventDefault();
              if (this.gameover) return;
              this.player.duck = true;
              duckTouchId = (e.changedTouches ? e.changedTouches[0].identifier : null);
            };
            const onLEnd = (e) => {
              e.preventDefault();
              if (duckTouchId === null) { this.player.duck = false; return; }
              const touches = e.changedTouches || [];
              for (const t of touches) {
                if (t.identifier === duckTouchId) {
                  this.player.duck = false;
                  duckTouchId = null;
                  break;
                }
              }
            };
            tzL.addEventListener('touchstart', onLStart, { passive: false });
            tzL.addEventListener('touchend', onLEnd, { passive: false });
            tzL.addEventListener('touchcancel', onLEnd, { passive: false });

            const onRStart = (e) => {
              e.preventDefault();
              const now = Date.now();
              if (now - lastTap < 300) {
                if (!this.running || this.gameover) this.startOrRestart();
              } else {
                if (!this.running) this.startOrRestart();
                else if (this.paused) this.paused = false;
                else this.jump(true);
              }
              lastTap = now;
            };
            tzR.addEventListener('touchstart', onRStart, { passive: false });
          }
        }

        _cooldownOk() { return true; }

        startOrRestart() {
          this.reset(this.level);
          this.running = true;
          this.paused = false;
          playBgm();          // âœ… ê²Œì„ ì‹œì‘ ì‹œ BGM ì¬ìƒ
        }

        resize() {
          const d = DPR();
          const rect = this.c.getBoundingClientRect();
          if (rect.width === 0 || rect.height === 0) {
            requestAnimationFrame(() => this.resize());
            return;
          }
          this.c.width = Math.floor(rect.width * d);
          this.c.height = Math.floor(rect.height * d);
        }

        setLevel(lv) {
          this.level = lv;
          this.p = paramsForLevel(lv);
          // ë ˆë²¨ ë³€ê²½ ì‹œì—ë„ ì ìˆ˜ ê¸°ë°˜ ì†ë„ ì¦ê°€ì˜ ê¸°ì¤€ê°’ ê°±ì‹ 
          this.baseStartSpd = this.p.startSpd;
          this.syncHUD(true);
        }

        syncHUD(initial = false) {
          $('#score').textContent = this.score | 0;
          $('#best').textContent = this.best | 0;
          $('#moves').textContent = (this.spd | 0);
          if (initial) updateTicketUI();
        }

        itemEmoji(kind) { return kind === 'speed' ? 'âš¡' : 'â¤ï¸'; }

        renderInvUI() {
          const el = document.getElementById('invHudList');
          if (!el) return;
          const items = this.inv.map(k => `<span class="slot">${this.itemEmoji(k)}</span>`).join('');
          const revive = this.revive > 0 ? ` <span class="rev">â¤ï¸Ã—${this.revive}</span>` : '';
          el.innerHTML = items + revive;
        }

        updatePointsUI() {
          const cap = this.pointsCap || 5000;
          $('#pointsAmt').textContent = (this.points | 0).toLocaleString('ko-KR');
          const pct = Math.max(0, Math.min(100, (this.points / cap) * 100));
          $('#pointsBar').style.width = pct.toFixed(1) + '%';
        }

        jump(pressed) {
          if (!pressed) return;
          const p = this.player;
          if (p.y >= this.groundY) {
            p.vy = this.p.jumpVy;
            p.jumps = 1;
          } else if (p.jumps < p.maxJumps) {
            p.vy = this.p.jumpVy * 0.9;
            p.jumps++;
          }
        }

        queueItem(kind) {
          this.inv.push(kind);
          this.renderInvUI();
          SFX.pickup();
        }

        useNextItem() {
          if (this.inv.length === 0) return;
          var kind = this.inv.shift();
          if (kind === 'speed') {
            this.itemInvActive = true;
            this.itemInvT = 5.0;
            this.itemSpeedMult = 3.0;
            this.flashT = 0.25;
          } else if (kind === 'revive') {
            this.revive++;
            this.flashT = 0.15;
          }
          this.renderInvUI();
        }

        jumpBands() {
          var v = Math.abs(this.p.jumpVy), g = this.p.gravity;
          var h1 = (v * v) / (2 * g), h2 = h1 * 0.81;
          var lowH = clamp(h1 * 0.95, 30, this.groundY - 40);
          var highH = clamp((h1 + h2) * 0.95, 60, this.groundY - 60);
          return { low: this.groundY - lowH, high: this.groundY - highH };
        }

        spawn() {
          var useBird = Math.random() < this.p.birdRate;
          if (useBird) {
            var alts = [this.groundY - 30, this.groundY - 70, this.groundY - 110];
            var pattern = (Math.random() < 0.4) ? 'flock' : (Math.random() < 0.5 ? 'zigzag' : 'solo');
            var count = pattern === 'flock' ? (2 + (Math.random() < 0.5 ? 1 : 0)) : 1;
            for (var i = 0; i < count; i++) {
              var alt = alts[Math.floor(Math.random() * alts.length)];
              var phase = Math.random() * Math.PI * 2;
              var amp = (pattern !== 'solo') ? this.rand(6, 16) : 0;
              var zspd = (pattern !== 'solo') ? this.rand(2, 4) : 0;
              this.objs.push({
                t: 'bird',
                x: this.logicalW + 10 + i * 36,
                y: alt,
                w: 46,
                h: 34,
                flap: 0,
                amp: amp,
                zspd: zspd,
                phase: phase,
                counted: false
              });
            }
          } else {
            var n = (Math.random() < this.p.flock) ? 2 + (Math.random() < 0.5 ? 1 : 0) : 1;
            for (var i = 0; i < n; i++) {
              var type = (Math.random() < 0.5) ? 's' : 't';
              var w = type === 's' ? 20 : 28;
              var h = type === 's' ? 40 : 60;
              var gap = (i === 0) ? 0 : (this.p.lowGap + this.rand(6, 18));
              var prevW = (i > 0 ? this.objs[this.objs.length - 1].w : 0);
              this.objs.push({
                t: 'cactus',
                x: this.logicalW + 10 + gap + prevW,
                y: this.groundY,
                w: w,
                h: h,
                counted: false
              });
            }
          }

          var r = Math.random();
          var kind = null;
          if (r < 0.30) kind = 'speed';
          else if (r < 0.40) kind = 'revive';
          if (kind) {
            var bands = this.jumpBands();
            var y = (Math.random() < 0.5) ? bands.low : bands.high;
            this.items.push({ t: 'item', kind: kind, x: this.logicalW + 20, y: y, r: 10 });
          }
        }

        collide(a, b) {
          return !(
            a.x + a.w - 6 < b.x ||
            a.x + 6 > b.x + b.w ||
            a.y < (b.y - b.h) ||
            (a.y - a.h) > b.y
          );
        }

        awardPoints(base) {
          let v = Math.max(0, Math.floor(base * difficultyMult()));
          this.points = Math.min(this.pointsCap, this.points + v);
          this.updatePointsUI();
        }

        update(dt) {
          if (!this.running || this.paused || this.gameover) return;

          var si = this.score | 0;
          if (si >= this.milestoneScoreNext) {
            const steps = Math.floor((si - (this.milestoneScoreNext - 100)) / 100) + 1;
            for (let k = 0; k < steps; k++) this.awardPoints(10);
            this.milestoneScoreNext += steps * 100;
            this.boostT = 2.0;
            this.flashT = 0.25;
            SFX.milestone();
          }

          if (this.itemInvActive) {
            this.itemInvT = Math.max(0, this.itemInvT - dt);
            if (this.itemInvT <= 0) {
              this.itemInvActive = false;
              this.itemSpeedMult = 1;
            }
          }

          // âœ… ì ìˆ˜ 200ì ë§ˆë‹¤ ê¸°ë³¸ ì´ë™ ì†ë„ ì†Œí­ ì¦ê°€
          const stepsForSpeed = Math.floor(si / (this.scoreSpeedStep || 200));
          const bonusFromScore = clamp(
            stepsForSpeed * (this.scoreSpeedBonusPerStep || 10),
            0,
            this.scoreSpeedBonusMax || 120
          );
          const dynamicStart = (this.baseStartSpd || this.p.startSpd) + bonusFromScore;

          var boost = (this.boostT > 0 ? 60 : 0);
          this.boostT = Math.max(0, this.boostT - dt);
          var mult = this.itemSpeedMult || 1;
          this.spd = clamp(this.spd + this.p.accel * dt, dynamicStart, this.p.maxSpd) * mult + boost;

          this.t += dt;
          this.dayT += dt;
          if (this.p.nightSec < 9999) {
            if (this.dayT >= this.p.nightSec) {
              this.dayT = 0;
              this.isNight = !this.isNight;
            }
          }

          this.nextSpawn -= dt * 1000;
          if (this.nextSpawn <= 0) {
            this.spawn();
            this.nextSpawn = this.p.spawnMin + (Math.random() * 420);
          }

          for (var i = 0; i < this.clouds.length; i++) {
            var c = this.clouds[i];
            c.x -= (this.spd * 0.2) * dt;
            if (c.x < -60) {
              c.x = this.logicalW + Math.random() * 120;
              c.y = this.rand(20, 90);
            }
          }

          var s = this.spd * dt;
          for (i = 0; i < this.objs.length; i++) {
            var o = this.objs[i];
            o.x -= s;
            if (o.t === 'bird') {
              o.flap += dt * 10;
              if (o.amp) {
                o.phase += o.zspd * dt;
                o.y += Math.sin(o.phase) * o.amp * dt * 10;
              }
            }
          }
          for (i = this.objs.length - 1; i >= 0; i--) {
            if (this.objs[i].x < -80) this.objs.splice(i, 1);
          }

          for (i = 0; i < this.items.length; i++) {
            this.items[i].x -= s;
          }
          for (i = this.items.length - 1; i >= 0; i--) {
            if (this.items[i].x < -40) this.items.splice(i, 1);
          }

          var p = this.player;
          p.vy += this.p.gravity * dt;
          p.y = Math.min(this.groundY, p.y + p.vy * dt);
          if (p.y >= this.groundY) {
            p.vy = 0;
            p.jumps = 0;
          }
          p.runT += dt;
          p.blinkT -= dt;
          if (p.blinkT <= 0) p.blinkT = this.rand(3, 7);

          this.score += this.spd * dt * 0.05;
          if (this.score > this.best) {
            this.best = this.score | 0;
            localStorage.setItem(LS_KEYS.best, String(this.best));
          }
          this.syncHUD();

          var hitBox = { x: p.x, y: p.y, w: p.duck ? 58 : 44, h: p.duck ? 26 : 48 };

          for (i = 0; i < this.items.length; i++) {
            var it = this.items[i];
            var ib = { x: it.x - 12, y: it.y, w: 24, h: 24 };
            if (this.collide(hitBox, ib)) {
              if (it.t === 'item') {
                this.queueItem(it.kind);
                SFX.pickup();
              }
              this.items.splice(i, 1);
            }
          }

          const pxEdge = this.player.x - 6;
          for (i = 0; i < this.objs.length; i++) {
            const ob = this.objs[i];
            if (!ob.counted && (ob.x + ob.w) < pxEdge) {
              ob.counted = true;
              this.avoided++;
              this.combo++;
              this.awardPoints(5);
              if (this.combo > 0 && this.combo % 10 === 0) {
                this.awardPoints(15);
              }
            }
          }

          if (!this.itemInvActive) {
            for (i = 0; i < this.objs.length; i++) {
              var ob = this.objs[i];
              var obBox = { x: ob.x, y: ob.y, w: ob.w, h: ob.h };
              if (this.collide(hitBox, obBox)) {
                if (this.revive > 0) {
                  this.doRevive();
                  break;
                } else {
                  this.doGameOver();
                  break;
                }
              }
            }
          }
        }

        doRevive() {
          this.revive--;
          this.itemInvActive = true;
          this.itemInvT = 5.0;
          this.itemSpeedMult = 1.5;
          this.flashT = 0.5;
          this.spawnBurst(this.player.x, this.player.y, this.isNight ? '#eee' : '#222');
          this.renderInvUI();
        }

        _tryMissionBonus() {
          const key = todayKey();
          const flags = loadJSON(LS_KEYS.mission, {});
          flags[key] = flags[key] || {};
          flags[key].runner = true;
          saveJSON(LS_KEYS.mission, flags);

          const rewarded = loadJSON(LS_KEYS.missionRewarded, {});
          if (rewarded[key]) return;
          const f = flags[key];
          if (f.runner && f['2048'] && f.tetris) {
            this.awardPoints(300);
            rewarded[key] = true;
            saveJSON(LS_KEYS.missionRewarded, rewarded);
            showToast('ì„¸íŠ¸ ë¯¸ì…˜ ë³´ìƒ +300P!', 1800);
          }
        }

        doGameOver(manual) {
          const leftover = (this.inv?.length || 0) + (this.revive || 0);
          if (leftover > 0) this.awardPoints(leftover * 5);

          this.gameover = true;
          this.running = false;
          $('#gameOver').style.display = 'flex';

          const finalScore = this.score | 0;
          const earnedPoints = this.points | 0;

          if (typeof window.addRecord === 'function') {
            window.addRecord(finalScore, earnedPoints);
          }
          addPlay();
          this.renderInvUI();
          this._tryMissionBonus();

          /* âœ… ê³„ì • ì§€ê°‘/ê¸€ë¡œë²Œ HUD ë³´ìƒ ì—°ë™ */
          try {
            const delta = (typeof window.calcReward === 'function')
              ? window.calcReward(finalScore, earnedPoints, this.level || 1)
              : { xp: 0, tickets: 0, coins: 0 };

            applyGlobalRewardAndSyncWallet('retro-running', delta, {
              score: finalScore,
              points: earnedPoints,
              level: this.level || 1
            });
          } catch (e) {
            console.error('reward sync error', e);
          }

          /* âœ… ì„¸ì…˜ ì¢…ë£Œ ì•Œë¦¼ */
          notifyFinish(finalScore);
        }

        drawCharacter(ctx, x, y, duck, phase, night) {
          ctx.save();
          ctx.translate(x, y);
          var body = night ? '#ffd1e6' : '#ff9cc2';
          var face = night ? '#fff' : '#ffddea';
          var eye = night ? '#eee' : '#222';
          var h = duck ? 26 : 48;
          var w = duck ? 58 : 44;

          ctx.fillStyle = body;
          ctx.beginPath();
          var r = 10;
          ctx.moveTo(-4, -h + r);
          ctx.quadraticCurveTo(-4, -h, -4 + r, -h);
          ctx.lineTo(-4 + w - r, -h);
          ctx.quadraticCurveTo(-4 + w, -h, -4 + w, -h + r);
          ctx.lineTo(-4 + w, -6 - r);
          ctx.quadraticCurveTo(-4 + w, -6, -4 + w - r, -6);
          ctx.lineTo(-4 + r, -6);
          ctx.quadraticCurveTo(-4, -6, -4, -6 - r);
          ctx.closePath();
          ctx.fill();

          ctx.fillStyle = face;
          ctx.fillRect(18, -h - 10, 16, 12);
          ctx.fillRect(30, -h - 26, 6, 16);
          ctx.fillRect(24, -h - 26, 6, 14);
          ctx.fillStyle = eye;
          ctx.fillRect(28, -h - 6, 3, 3);
          ctx.restore();
        }

        drawCactus(ctx, x, y, w, h, night) {
          ctx.save();
          ctx.translate(x, y);
          var g = ctx.createRadialGradient(
            w * 0.5, -h * 0.6, Math.max(6, w * 0.2),
            w * 0.4, -h * 0.6, Math.max(14, w)
          );
          g.addColorStop(0, night ? '#aab3c8' : '#8088a0');
          g.addColorStop(1, night ? '#5e6578' : '#676e82');
          ctx.fillStyle = g;
          ctx.beginPath();
          var rx = Math.max(6, w * 0.45), ry = Math.max(8, h * 0.55);
          ctx.ellipse(w * 0.5, -h * 0.5, rx, ry, 0, 0, Math.PI * 2);
          ctx.fill();

          ctx.strokeStyle = night ? '#2f3444' : '#63708a';
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(w * 0.25, -h * 0.35);
          ctx.lineTo(w * 0.45, -h * 0.2);
          ctx.lineTo(w * 0.65, -h * 0.32);
          ctx.stroke();
          ctx.restore();
        }

        drawBird(ctx, x, y, flap, night) {
          ctx.save();
          ctx.translate(x, y);
          ctx.fillStyle = night ? '#ddd' : '#222';
          var wing = Math.sin(flap) * 4;
          ctx.fillRect(-14, -8, 28, 16);
          ctx.fillRect(-18, -2 + wing, 12, 4);
          ctx.fillRect(6, -2 - wing, 12, 4);
          ctx.restore();
        }

        drawItem(ctx, x, y, kindOrVal, night) {
          ctx.save();
          ctx.translate(x, y);
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          if (typeof kindOrVal === 'string') {
            const emoji = (kindOrVal === 'speed') ? 'âš¡' : 'â¤ï¸';
            ctx.font = '20px system-ui, "Apple SD Gothic Neo", "Segoe UI Emoji", sans-serif';
            ctx.fillText(emoji, 0, 0);
          } else {
            const size = 18;
            ctx.font = size + 'px system-ui, "Apple SD Gothic Neo", "Segoe UI Emoji", sans-serif';
            ctx.fillText('ğŸŸ¡', 0, 0);
          }
          ctx.restore();
        }

        drawGround(ctx, offset, night) {
          var y = this.groundY + 2;
          var gH = this.logicalH - y;
          var grad = ctx.createLinearGradient(0, y, 0, this.logicalH);
          grad.addColorStop(0, night ? '#3a2a1e' : '#8a5a3a');
          grad.addColorStop(1, night ? '#2f2318' : '#6e462c');
          ctx.fillStyle = grad;
          ctx.fillRect(0, y, this.logicalW, gH);

          var grass = ctx.createLinearGradient(0, y - 10, 0, y + 6);
          grass.addColorStop(0, night ? '#3b6b3b' : '#6ec36e');
          grass.addColorStop(1, night ? '#2a572a' : '#4faa52');
          ctx.fillStyle = grass;
          ctx.fillRect(0, y - 10, this.logicalW, 12);

          ctx.fillStyle = night ? '#2c6a2c' : '#3ea849';
          for (var i = 0; i < 60; i++) {
            var x = ((i * 60 - (offset % 60)) + this.logicalW) % this.logicalW;
            ctx.fillRect(x, y - 12, 18, 2);
          }
        }

        drawHUD(ctx) {
          var txt =
            (this.score | 0).toString().padStart(5, '0') +
            '  HI ' +
            (this.best | 0).toString().padStart(5, '0');
          var blink = ((this.score | 0) >= this.best) && (this.gameover || this.boostT > 0);
          ctx.fillStyle = this.isNight ? '#eee' : '#222';
          ctx.font = '12px ui-monospace';
          ctx.textAlign = 'right';
          if (blink && ((performance.now() / 200 | 0) % 2 === 0)) {
            ctx.fillStyle = this.isNight ? '#aaa' : '#666';
          }
          ctx.fillText(txt, this.logicalW - 12, 18);

          if (!this.running && !this.gameover) {
            ctx.textAlign = 'center';
            ctx.fillText(
              'SPACE/ENTER = START  |  SPACE/UP = JUMP(2x)  |  DOWN = DUCK  |  U = PAUSE  |  I = ITEM',
              this.logicalW / 2,
              60
            );
          }
          if (this.gameover) {
            ctx.textAlign = 'center';
            ctx.fillText(
              'GAME OVER  â€”  PRESS SPACE/ENTER TO RESTART',
              this.logicalW / 2,
              60
            );
          }
        }

        spawnBurst(x, y, color) {
          this.fx = this.fx || [];
          for (var i = 0; i < 24; i++) {
            this.fx.push({
              x: x,
              y: y,
              vx: this.rand(-140, 140),
              vy: this.rand(-220, -60),
              life: this.rand(0.3, 0.8),
              color: color
            });
          }
        }

        drawFX(ctx) {
          this.fx = this.fx || [];
          for (var i = this.fx.length - 1; i >= 0; i--) {
            var p = this.fx[i];
            p.x += p.vx * 0.033;
            p.y += p.vy * 0.033;
            p.vy += 400 * 0.033;
            p.life -= 0.033;
            if (p.life <= 0) {
              this.fx.splice(i, 1);
              continue;
            }
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, 2, 2);
          }
        }

        draw() {
          const ctx = this.bctx;
          ctx.imageSmoothingEnabled = false;
          ctx.clearRect(0, 0, this.logicalW, this.logicalH);

          this.flashT = Math.max(0, (this.flashT || 0) - 0.033);

          var sky = ctx.createLinearGradient(0, 0, 0, this.logicalH);
          if (this.isNight) {
            sky.addColorStop(0, '#0a1230');
            sky.addColorStop(1, '#1a1f3f');
          } else {
            sky.addColorStop(0, '#bfe8ff');
            sky.addColorStop(1, '#e9f8ff');
          }
          ctx.fillStyle = sky;
          ctx.fillRect(0, 0, this.logicalW, this.logicalH);

          ctx.fillStyle = this.isNight ? '#777' : '#999';
          for (var i = 0; i < this.clouds.length; i++) {
            var c = this.clouds[i];
            ctx.fillRect(c.x, c.y, 28, 8);
            ctx.fillRect(c.x + 10, c.y - 6, 18, 6);
          }

          this.drawGround(ctx, this.t * this.spd, this.isNight);

          for (var i = 0; i < this.items.length; i++) {
            var it = this.items[i];
            if (it.t === 'item') this.drawItem(ctx, it.x, it.y, it.kind, this.isNight);
            else this.drawItem(ctx, it.x, it.y, it.val, this.isNight);
          }

          for (i = 0; i < this.objs.length; i++) {
            var o = this.objs[i];
            if (o.t === 'cactus') this.drawCactus(ctx, o.x, o.y, o.w, o.h, this.isNight);
            else this.drawBird(ctx, o.x, o.y, o.flap, this.isNight);
          }

          this.drawCharacter(ctx, this.player.x, this.player.y, this.player.duck, this.player.runT, this.isNight);

          this.drawFX(ctx);

          if (this.flashT > 0) {
            ctx.fillStyle = this.isNight
              ? 'rgba(255,255,255,' + (0.25 * this.flashT) + ')'
              : 'rgba(0,0,0,' + (0.25 * this.flashT) + ')';
            ctx.fillRect(0, 0, this.logicalW, this.logicalH);
          }

          this.drawHUD(ctx);

          const mctx = this.ctx;
          mctx.imageSmoothingEnabled = false;
          mctx.clearRect(0, 0, this.c.width, this.c.height);
          const cw = this.c.width, ch = this.c.height;
          const scale = Math.min(cw / this.logicalW, ch / this.logicalH);
          const dw = this.logicalW * scale, dh = this.logicalH * scale;
          const ox = (cw - dw) / 2, oy = (ch - dh) / 2;
          mctx.fillStyle = '#000';
          if (oy > 0) {
            mctx.fillRect(0, 0, cw, oy);
            mctx.fillRect(0, ch - oy, cw, oy);
          }
          if (ox > 0) {
            mctx.fillRect(0, 0, ox, ch);
            mctx.fillRect(cw - ox, 0, ox, ch);
          }
          mctx.drawImage(this.buf, 0, 0, this.logicalW, this.logicalH, ox, oy, dw, dh);

          mctx.globalAlpha = 0.12;
          mctx.fillStyle = '#000';
          for (let yy = 0; yy < ch; yy += 2) {
            mctx.fillRect(0, yy, cw, 1);
          }
          mctx.globalAlpha = 1;
        }

        loop() {
          let last = performance.now();
          const step = (now) => {
            const dt = Math.min(0.033, (now - last) / 1000);
            last = now;
            this.update(dt);
            this.draw();
            requestAnimationFrame(step);
          };
          requestAnimationFrame(step);
        }
      }

      window.addEventListener('load', async () => {
        try{
          const ra = (window.requireAuth || (window.RG && window.RG.requireAuth));
          if (typeof ra === 'function') await ra();
        }catch(e){
          return;
        }

        // âœ… ì¸ì¦ ì™„ë£Œ â†’ ì„¸ì…˜ ì‹œì‘(runId í™•ë³´)
        notifyStart();
        
        const game = new Dino(document.getElementById('game'));
        (function initUI(){
          const tier = $('#tier'), lvl = $('#lvlRange');

          const applyTier = (t) => {
            let lv = { beginner: 1, intermediate: 11, advanced: 21, hell: 40, doom: 50, insane: 100 }[t] || 1;
            lvl.value = lv;
            game.setLevel(lv);
          };

          applyTier(tier.value);
          lvl.addEventListener('input', () => game.setLevel(+lvl.value));

          // í‹°ì¼“ UI
          updateTicketUI();
          // ì„œë²„ wallet ìµœì‹  ë°˜ì˜
          if(typeof window.refreshWalletHUD === 'function') window.refreshWalletHUD();
        })();
}, { once:true });
    })();

    /***** Cabinet fit *****/
    function fitCabinet(){
      const cab = document.querySelector('.cabinet');
      if (!cab) return;
      const margin = 16;
      cab.style.transform = 'none';
      const w = cab.offsetWidth;
      const h = cab.offsetHeight;
      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const needScale = (w > vw - margin*2) || (h > vh - margin*2);
      const scale = needScale
        ? Math.min(1, (vw - margin*2)/w, (vh - margin*2)/h)
        : 1;
      cab.style.transform = `scale(${scale})`;
    }

    window.addEventListener('resize', ()=> requestAnimationFrame(fitCabinet), {passive:true});
    window.addEventListener('load', () => requestAnimationFrame(fitCabinet));
    window.addEventListener('orientationchange', ()=> requestAnimationFrame(fitCabinet), {passive:true});
    setTimeout(fitCabinet, 0);

    /***** âœ… ì„¸ì…˜ í›…(ì•ˆì „ ë˜í¼): í—ˆë¸Œ ë¶„ì„ìš© ì•± í›… í˜¸ì¶œ *****/
    let __rg_finish_sent_retro_running = false;

    function notifyStart() {
      try {
        __rg_finish_sent_retro_running = false;
        if (typeof window.gameStart === 'function') window.gameStart('retro-running');
      } catch (e) { }
    }

    async function notifyFinish(finalScore) {
      if (__rg_finish_sent_retro_running) return;
      __rg_finish_sent_retro_running = true;
      try {
        // âœ… /api/games/finish ê²½ë¡œ ì°¨ë‹¨
        // âœ… ë³´ìƒ/ì§€ê°‘ ë°˜ì˜ì€ applyGlobalRewardAndSyncWallet â†’ sendGameReward(/api/wallet/reward) ë‹¨ì¼ ë£¨íŠ¸ë§Œ ì‚¬ìš©
      } catch (e) {
        __rg_finish_sent_retro_running = false;
      }
    }

    /***** ê°€ì‹œì„± í›… + BGM ì œì–´ *****/
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        pauseBgm();
      } else {
        playBgm();
      }
    });

    function addRecord(score, points) {
  const recs = loadJSON(LS_KEYS.records, []);
  const now  = new Date();
  recs.unshift({
    ts: now.toISOString(),
    score: score | 0,
    points: points | 0
  });
  saveJSON(LS_KEYS.records, recs.slice(0, 200)); // ìµœëŒ€ 200ê°œ ìœ ì§€
}

    function showRecords() {
      const recs = loadJSON(LS_KEYS.records, []);
      const rows = recs.map(r => {
        const d = new Date(r.ts);
        const dateStr = d.toLocaleString('ko-KR');
        return `
          <tr>
            <td style="padding:6px 8px;border-bottom:1px solid #233077">${dateStr}</td>
            <td style="padding:6px 8px;text-align:right;border-bottom:1px solid #233077">${fmt(r.score || 0)}</td>
            <td style="padding:6px 8px;text-align:right;border-bottom:1px solid #233077">${fmt(r.points || 0)}</td>
          </tr>`;
      }).join('');

      const body = document.getElementById('recBody');
      if (body) {
        body.innerHTML = `
          <table style="width:100%;border-collapse:collapse;font-size:13px">
            <thead>
              <tr>
                <th style="text-align:left;padding:8px;border-bottom:1px solid #314099">ë‚ ì§œ/ì‹œê°„</th>
                <th style="text-align:right;padding:8px;border-bottom:1px solid #314099">ì ìˆ˜</th>
                <th style="text-align:right;padding:8px;border-bottom:1px solid #314099">í¬ì¸íŠ¸</th>
              </tr>
            </thead>
            <tbody>${rows}</tbody>
          </table>`;
      }
      const modal = document.getElementById('recModal');
      if (modal) modal.style.display = 'flex';
    }

    // ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ì „ì—­ì— ë“±ë¡
    window.addRecord   = addRecord;
    window.showRecords = showRecords;

    // Records Modal bindings
    (function () {
      const btn   = document.getElementById('recordsBtn');
      const modal = document.getElementById('recModal');
      const close = document.getElementById('recClose');

      if (btn)   btn.addEventListener('click', showRecords);
      if (close) close.addEventListener('click', () => { modal.style.display = 'none'; });
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) modal.style.display = 'none';
        });
      }
    })();

  </script>

  <div id="cookieBanner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Analytics consent">
    <div>ì„œë¹„ìŠ¤ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•œ ë¶„ì„(ì¿ í‚¤) ì‚¬ìš©ì— ë™ì˜í•˜ì‹œë‚˜ìš”?</div>
    <div class="spacer"></div>
    <button class="deny" type="button">ê±°ë¶€</button>
    <button class="agree" type="button">ë™ì˜</button>
  </div>

  <script>
    (function () {
      try {
        var KEY = 'rg_analytics_consent';
        function init() { if (typeof window.analyticsInit === 'function') window.analyticsInit(); }
        var v = null;
        try { v = localStorage.getItem(KEY); } catch (e) { }
        var el = document.getElementById('cookieBanner');
        if (v === 'yes') { init(); if (el) el.style.display = 'none'; return; }
        if (!el) { return; } // no banner -> do not init
        el.style.display = 'flex';
        var agree = el.querySelector('.agree'), deny = el.querySelector('.deny');
        if (agree) agree.addEventListener('click', function () {
          try { localStorage.setItem(KEY, 'yes'); } catch (e) { }
          el.style.display = 'none'; init();
        });
        if (deny) deny.addEventListener('click', function () {
          try { localStorage.setItem(KEY, 'no'); } catch (e) { }
          el.style.display = 'none';
        });
      } catch (e) { /* no-op */ }
    })();
  </script>

  <!--
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    3-2. HUD ë Œë”ë§ ë¡œì§ ë‹¨ì¼í™” â€“ RETRO RUNNING ì ìš© ë©”ëª¨ (ë¹„ì‹¤í–‰ ì£¼ì„)
    ----------------------------------------------------------------
    â–  1ë‹¨ê³„. HUD DOM í†µì¼í•˜ê¸°

      â€» ê³µí†µ í—¤ë”(ë˜ëŠ” HUD ìœ„ìª½)ì— ì•„ë˜ êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ í•œ ë²ˆë§Œ ë§Œë“¤ì–´ ë‘ê³ ,
         ë‹¤ë¥¸ í˜ì´ì§€ëŠ” ì „ë¶€ ì´ íŒŒì…œì„ include í•˜ëŠ” ì‹ìœ¼ë¡œ ë§ì¶”ëŠ” ê·œì¹™.

      ì˜ˆ) /partials/hud.html ë˜ëŠ” header.html ì•ˆìª½ì— í¬í•¨ë˜ëŠ” DOM

        <div id="rg-hud" class="hud-bar requires-auth">
          <span class="hud-item hud-level">
            LV. <span data-hud="level"></span>
          </span>
          <span class="hud-item hud-exp">
            EXP <span data-hud="exp"></span>
          </span>
          <span class="hud-item hud-coins">
            Coins <span data-hud="coins"></span>
          </span>
          <span class="hud-item hud-tickets">
            Tickets <span data-hud="tickets"></span>
          </span>
          <span class="hud-item hud-games">
            Plays <span data-hud="gamesPlayed"></span>
          </span>
        </div>

      Â· ì´ë¯¸ ê° í˜ì´ì§€ì— HUDê°€ ìˆì„ ê±°ë‹ˆê¹Œ,
          - id="rg-hud" ë¥¼ ë¶™ì´ê³ ,
          - ìˆ«ìê°€ ë“¤ì–´ê°€ëŠ” spanì— data-hud="â€¦" ì†ì„±ë§Œ ë§ì¶°ì£¼ë©´ ë.

      Â· ì¤‘ìš”í•œ ê±´ "ì–´ë–¤ í˜ì´ì§€ë“  HUD ìˆ«ìëŠ” data-hud í‚¤ë§Œ ê°™ê²Œ" ë§Œë“ ë‹¤ëŠ” ê²ƒ.
        ì´ë ‡ê²Œ í•´ë‘ë©´ JSëŠ” DOM ì„¸ë¶€ êµ¬ì¡°ëŠ” ì‹ ê²½ ì•ˆ ì“°ê³ ,
        "data-hud='level'" ê°™ì€ í‚¤ë§Œ ë³´ê³  ê°’ë§Œ ì±„ìš°ë©´ ë¨.

      Â· ì´ íŒŒì¼( public/games/retro-running.html )ì—ì„œëŠ”
          - <header class="marquee"> ë°”ë¡œ ì•„ë˜ì—
              #rg-hud ë¸”ë¡ì„ ì¶”ê°€
          - ê¸°ì¡´ ê²Œì„ ì „ìš© HUD(.hud) ë¸”ë¡ì€ ê·¸ëŒ€ë¡œ ìœ ì§€
          - ìŠ¤íƒ€ì¼, ê²Œì„ ë¡œì§, ê´‘ê³  êµ¬ì¡°, ë²„íŠ¼ êµ¬ì„± ë“±ì€ 100% ê¸°ì¡´ ë™ì‘ ìœ ì§€

      Â· ê³µí†µ HUDì— ì‚¬ìš©ë˜ëŠ” data-hud í‚¤ ëª©ë¡
          level       : ê³„ì • ë ˆë²¨
          exp         : ëˆ„ì  ê²½í—˜ì¹˜ ë˜ëŠ” ê²½í—˜ì¹˜ ê²Œì´ì§€
          coins       : í¬ì¸íŠ¸/ì½”ì¸
          tickets     : í‹°ì¼“ ìˆ˜ëŸ‰
          gamesPlayed : ëˆ„ì  í”Œë ˆì´(ë˜ëŠ” ì¼ì¼/ì£¼ê°„ í”Œë ˆì´ ìˆ˜)

      Â· ìˆ«ì ì±„ìš°ê¸°(ë Œë”ë§)ëŠ” /assets/js/app.js ìª½ ì „ì—­ HUD ë Œë”ëŸ¬ê°€ ë‹´ë‹¹.
        game HTMLì—ì„œëŠ” ì˜¤ë¡œì§€ DOM êµ¬ì¡°(id / class / data-hud)ë§Œ ë§ì¶˜ë‹¤.

    â–  2ë‹¨ê³„. ìœ ì§€ë³´ìˆ˜ ì‹œ ì²´í¬ í¬ì¸íŠ¸

      1) HUD í•­ëª©ì´ ëŠ˜ì–´ë‚  ë•Œ
         - app.js ì˜ HUD ë Œë” í•¨ìˆ˜ì— ìƒˆ í‚¤(data-hud="â€¦") ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
         - /partials/hud.html ê³¼ ê° ê²Œì„ í˜ì´ì§€ì˜ #rg-hud ì•ˆì— ë™ì¼í•œ span ì¶”ê°€

      2) ìŠ¤íƒ€ì¼ ë³€ê²½
         - ê°€ëŠ¥í•˜ë©´ ì „ì—­ CSS ë˜ëŠ” í—¤ë” íŒŒì…œì—ì„œ ìŠ¤íƒ€ì¼ì„ ìˆ˜ì •
         - ê²Œì„ íŒŒì¼ ë‚´ë¶€ì—ì„œëŠ” HUD ë ˆì´ì•„ì›ƒ/ìƒ‰ìƒì€ ê±´ë“œë¦¬ì§€ ì•Šê³ ,
           ìµœì†Œí•œì˜ DOM ì¶”ê°€ë§Œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ì›ì¹™ìœ¼ë¡œ í•¨.

      3) ê²Œì„ë³„ ì „ìš© HUD(.hud)ì™€ì˜ ê´€ê³„
         - #rg-hud : ê³„ì •/ì›”ë ›/í†µê³„ìš© ê¸€ë¡œë²Œ HUD (ê³µí†µ ê·œê²©)
         - .hud    : ê° ê²Œì„ ë‚´ ì ìˆ˜/ìŠ¤í…Œì´ì§€/ì•„ì´í…œ ë“± ê²Œì„ ì „ìš© HUD
         - ë‘ ë¸”ë¡ ëª¨ë‘ ë™ì‹œì— ì¡´ì¬í•  ìˆ˜ ìˆê³ , ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤Œ.

      ì´ ì£¼ì„ ë¸”ë¡ì€ ì„¤ê³„/ìš´ì˜ ë©”ëª¨ ìš©ë„ë¡œë§Œ ì¡´ì¬í•˜ë©°,
      ì‹¤ì œ ì‹¤í–‰ ë¡œì§ê³¼ ìŠ¤íƒ€ì¼ì—ëŠ” ì–´ë– í•œ ì˜í–¥ë„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  -->

</body>
</html>
