<!DOCTYPE html>
<html lang="ko" data-env="prod">
<head>
<meta name="description" content="ë§ˆì´í˜ì´ì§€ â€” í”„ë¡œí•„, ì§€ê°‘, ì¸ë²¤í† ë¦¬, ìµœê·¼ ê²Œì„ ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”.">
<meta property="og:title" content="RETRO GAMES â€“ ë§ˆì´í˜ì´ì§€">
<meta property="og:description" content="ë§ˆì´í˜ì´ì§€ â€” í”„ë¡œí•„, ì§€ê°‘, ì¸ë²¤í† ë¦¬, ìµœê·¼ ê²Œì„ ê¸°ë¡ì„ í™•ì¸í•˜ì„¸ìš”.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://retrogames.kr/">
<meta property="og:image" content="https://retrogames.kr/assets/og-cover.png">
<meta name="twitter:card" content="summary_large_image">
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>RETRO GAMES â€“ ë§ˆì´í˜ì´ì§€</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="icon" href="/assets/favicon.ico">
<style>
  :root{
    --cabinet:#071933; --cabinet2:#0b2a57; --bezel:#0c1e3f; --glow:#0ea5ff; --side:#f4be09;
    --btn:#133262; --btnBorder:#285dd1; --btnFg:#e9f1ff; --ink:#e9f0ff; --bg:#0b001e;
    --card:#101a33; --card2:#0d1529; --gold1:#ffdf6e; --gold2:#ffb84d; --ok:#16c784; --warn:#ffcc66; --bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(circle at 40% -10%,#320076,#0b001e 70%);color:var(--ink);
    font-family:'Segoe UI', system-ui, Apple SD Gothic Neo, Pretendard, sans-serif}
  a{color:#cfe2ff;text-decoration:none}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(5,10,30,.9),rgba(5,10,30,.6));backdrop-filter:blur(6px);
    border-bottom:1px solid rgba(255,255,255,.08);z-index:10}
  .nav{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;align-items:center;gap:14px}
  .brand{font-weight:900;letter-spacing:.5px}
  .sp{flex:1}
  .nav a.btn{padding:8px 12px;border-radius:12px;border:1px solid var(--btnBorder);
    background:linear-gradient(180deg,#1a2b7a,#0a1a64);color:var(--btnFg);font-weight:700}
  main{max-width:1100px;margin:16px auto 48px;padding:0 16px;display:grid;gap:16px}
  .card{background:linear-gradient(180deg,var(--card),var(--card2));border:1px solid rgba(255,255,255,.08);
    border-radius:16px;box-shadow:0 12px 28px rgba(0,0,0,.35),inset 0 0 32px rgba(255,255,255,.04)}
  .card h2{margin:0;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.06)}
  .card .body{padding:14px 16px}
  .grid{display:grid;gap:16px}
  .grid.cols-2{grid-template-columns:1fr 1fr}
  .grid.cols-3{grid-template-columns:repeat(3,1fr)}
  .kv{display:grid;grid-template-columns:160px 1fr;gap:10px;padding:8px 0;border-bottom:1px dashed rgba(255,255,255,.08)}
  .kv:last-child{border-bottom:0}
  .tag{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.08);font-size:12px}
  .list{display:grid;gap:8px}
  .list .row{display:grid;grid-template-columns:120px 1fr 100px;gap:8px;align-items:center;padding:8px;border-radius:12px;
    background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06)}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap}
  .btn-ghost{padding:8px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.04);
    color:var(--ink);font-weight:700;cursor:pointer}
  .btn-gold{padding:8px 12px;border-radius:12px;border:1px solid #7a5600;background:linear-gradient(180deg,var(--gold1),var(--gold2));
    color:#3a2400;font-weight:900;cursor:pointer}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left;font-size:14px}
  th{opacity:.8}
  .muted{opacity:.8}
  footer{max-width:1100px;margin:32px auto;padding:0 16px;color:#a8b3cf;opacity:.8;font-size:13px}
  @media(max-width:900px){ .grid.cols-2{grid-template-columns:1fr} .grid.cols-3{grid-template-columns:1fr 1fr} }
  @media(max-width:640px){ .grid.cols-3{grid-template-columns:1fr} .kv{grid-template-columns:120px 1fr} }
</style>
<!-- Load consent -> analytics in order -->
<script defer src="/assets/js/consent.js"></script>
<script defer src="/assets/js/analytics.js"></script>
</head>

<body>
  <div id="site-header"></div>

<header>
  <nav class="nav" aria-label="ì£¼ìš” ë©”ë‰´">
    <div class="brand">ğŸ•¹ï¸ JINBIZ Arcade</div>
    <a class="btn" href="/index.html" id="btnHomeNav">í™ˆ</a>
    <a class="btn" href="/shop.html">ìƒì </a>
    <a class="btn" href="/features/today-lucky.html">ì˜¤ëŠ˜ì˜ í–‰ìš´</a>
    <div class="sp"></div>
    <a class="btn" href="/user-retro-games.html">ë‚´ ê²Œì„</a>
    <a class="btn" href="/mypage.html">ë§ˆì´í˜ì´ì§€</a>
  </nav>
</header>

<main class="grid cols-2">
  <section class="card">
    <h2>í”„ë¡œí•„</h2>
    <div class="body">
      <div class="kv"><div>ë‹‰ë„¤ì„</div><div id="nick" class="muted">-</div></div>
      <div class="kv"><div>ì´ë©”ì¼</div><div id="email" class="muted">-</div></div>
      <div class="kv"><div>ê°€ì…ì¼</div><div id="joined" class="muted">-</div></div>
      <div class="btn-row" style="margin-top:10px">
        <button class="btn-ghost" id="btnRefresh">ìƒˆë¡œê³ ì¹¨</button>
        <a class="btn-ghost" href="/user-retro-games.html">ë‚´ ê²Œì„ìœ¼ë¡œ</a>
        <a class="btn-gold" href="/features/today-lucky.html">ì˜¤ëŠ˜ì˜ í–‰ìš´ ë½‘ê¸°</a>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>ì§€ê°‘</h2>
    <div class="body">
      <div class="kv"><div>ì½”ì¸</div><div id="coins">0</div></div>
      <div class="kv"><div>ê²½í—˜ì¹˜</div><div id="xp">0</div></div>
      <div class="kv"><div>ì—°ì† ì¶œì„</div><div id="streak">0</div></div>
    </div>
  </section>

  <section class="card">
    <h2>ë³´ìœ  ì•„ì´í…œ</h2>
    <div class="body" id="inventory">
      <div class="muted">ìƒì ì—ì„œ êµ¬ë§¤í•œ ì•„ì´í…œì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
      <div class="btn-row" style="margin-top:10px">
        <a class="btn-ghost" href="/shop.html">ìƒì ìœ¼ë¡œ ê°€ê¸°</a>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>ì ìš© ì¤‘ì¸ íš¨ê³¼</h2>
    <div class="body" id="effects">
      <div class="muted">íšë“í•œ ë¶€ìŠ¤íŠ¸/ë°°ìˆ˜ íš¨ê³¼ê°€ ìˆìœ¼ë©´ ìë™ ì ìš©ë©ë‹ˆë‹¤.</div>
    </div>
  </section>

  <section class="card" style="grid-column:1 / -1">
    <h2>ìµœê·¼ ê²Œì„ ê¸°ë¡</h2>
    <div class="body">
      <table id="runs">
        <thead><tr><th>ê²Œì„</th><th>ì ìˆ˜</th><th>í”Œë ˆì´ ì‹œê°„</th><th>ì¼ì‹œ</th></tr></thead>
        <tbody><tr><td colspan="4" class="muted">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr></tbody>
      </table>
    </div>
  </section>
</main>

<footer class="muted">
  Â©2025 ì§„ë¹„ì¦ˆ ë§¤ë‹ˆì§€ë¨¼íŠ¸ â”ƒ ê´‘ê³ ë¬¸ì˜ jinbizman@gmail.com â”ƒ RETRO GAMES Â· Neon UI â”ƒ MADE BY ONLY OPEN AI
  <a href="/about.html">About</a> Â· <a href="/help.html">Help</a>
</footer>

<script>
  // Safe analytics init hook (if consent.js sets window.analyticsInit elsewhere)
  window.analyticsInit = window.analyticsInit || function(){ try{ console.debug('analyticsInit (extra pages)'); }catch(e){} };
</script>

<script>
/* ------------------------------------------------------------------
 *  ê³µí†µ ìƒìˆ˜ / ìœ í‹¸
 * ------------------------------------------------------------------ */
const RG_BASE           = "/";
const RG_AUTH_ME_URLS   = ["/api/auth/me","/api/me","/auth/me"];
const RG_WALLET_URLS    = ["/wallet/summary","/api/wallet","/users/me/wallet"];
const RG_INV_URLS       = ["/shop/inventory","/api/inventory","/users/me/inventory"];
const RG_EFF_URLS       = ["/shop/effects","/api/effects","/users/me/effects"];
const RG_RUNS_URLS      = ["/games/runs","/api/game-runs","/users/me/game-runs"];
const RG_ANALYTICS_URLS = ["/api/analytics/events","/analytics/events"];

/* ------------------------------------------------------------------
 *  ğŸ”Š ë©”ì¸ í—ˆë¸Œ BGM (main-background.mp3)
 *  - /assets/music/main-background.mp3
 *  - ë³¼ë¥¨ 30%, loop
 *  - rg_user_settings(soundMaster / bgm)ì™€ ì—°ë™
 * ------------------------------------------------------------------ */
const BGM_SRC_MAIN = "/assets/music/main-background.mp3";
let bgmMainEl = null;
let bgmMainReady = false;

function rgLoadSettings(){
  try{
    const raw = localStorage.getItem("rg_user_settings");
    if(!raw){
      return {
        soundMaster:true,
        bgm:true,
        backgroundFx:true,
        reducedMotion:false,
        gameCountdown:true,
        gameHints:true
      };
    }
    const parsed = JSON.parse(raw) || {};
    return {
      soundMaster: parsed.soundMaster !== false,
      bgm:         parsed.bgm         !== false,
      backgroundFx:parsed.backgroundFx !== false,
      reducedMotion:!!parsed.reducedMotion,
      gameCountdown: parsed.gameCountdown !== false,
      gameHints:     parsed.gameHints     !== false
    };
  }catch(e){
    return {
      soundMaster:true,
      bgm:true,
      backgroundFx:true,
      reducedMotion:false,
      gameCountdown:true,
      gameHints:true
    };
  }
}
function rgShouldPlayMainBgm(){
  const s = rgLoadSettings();
  return !!(s.soundMaster && s.bgm);
}
function rgEnsureMainBgm(){
  if(bgmMainEl) return bgmMainEl;
  bgmMainEl = document.createElement("audio");
  bgmMainEl.src = BGM_SRC_MAIN;
  bgmMainEl.loop = true;
  bgmMainEl.volume = 0.3; // ğŸ”Š 30%
  bgmMainEl.setAttribute("preload","auto");
  bgmMainEl.style.display = "none";
  document.body.appendChild(bgmMainEl);
  return bgmMainEl;
}
async function rgTryPlayMainBgm(){
  const audio = rgEnsureMainBgm();
  if(!rgShouldPlayMainBgm()){
    try{ audio.pause(); }catch(_){}
    return;
  }
  try{
    await audio.play();
    bgmMainReady = true;
  }catch(e){
    bgmMainReady = false;
  }
}
function rgHandleMainBgmUserGesture(){
  if(bgmMainReady) return;
  rgTryPlayMainBgm();
}
document.addEventListener("click", rgHandleMainBgmUserGesture, { once:true });
document.addEventListener("keydown", rgHandleMainBgmUserGesture, { once:true });
window.addEventListener("storage", function(e){
  if(e.key === "rg_user_settings"){
    rgTryPlayMainBgm();
  }
});
document.addEventListener("DOMContentLoaded", function(){
  setTimeout(rgTryPlayMainBgm, 300);
});

/* ------------------------------------------------------------------
 *  ë©”ì¸ ë¡œì§ (ë§ˆì´í˜ì´ì§€ ë°ì´í„° + ê²Œì„ ì—°ë™ ë¸Œë¦¿ì§€)
 * ------------------------------------------------------------------ */
(async function(){
  const $ = s => document.querySelector(s);
  const setText = (id, v) => {
    const el = document.getElementById(id);
    if(el) el.textContent = v;
  };
  async function tryFetchJson(urls, opt){
    for(const u of urls){
      try{
        const r = await fetch(u, opt);
        if(r.ok) return await r.json();
      }catch(e){}
    }
    return null;
  }

  /* -------------------------------
   *  í™ˆ ë²„íŠ¼: ìœ ì € ì¸ì‹ í›„ ë©”ì¸ìœ¼ë¡œ
   * ------------------------------- */
  async function rgDetectUser(){
    const me = await tryFetchJson(RG_AUTH_ME_URLS, {
      method:"GET",
      credentials:"include",
      headers:{ "Accept":"application/json","Cache-Control":"no-store" }
    });
    if(!me || me.error) return null;
    return me.user || me;
  }
  async function rgGoHome(){
    try{
      const user = await rgDetectUser();
      if(user){
        // ë¡œê·¸ì¸ ìƒíƒœ â†’ ë©”ì¸ í—ˆë¸Œë¡œ
        window.location.href = RG_BASE + "user-retro-games.html";
        return;
      }
    }catch(e){
      console.warn("[RG][mypage] auth check failed on HOME:", e);
    }
    // ì„¸ì…˜ ì—†ìŒ/ì˜¤ë¥˜ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ, ì™„ë£Œ í›„ ë©”ì¸ í—ˆë¸Œë¡œ ë³µê·€
    try{
      const next = encodeURIComponent(RG_BASE + "user-retro-games.html");
      window.location.href = RG_BASE + "login.html?next=" + next;
    }catch(e){
      window.location.href = RG_BASE + "login.html";
    }
  }
  const homeNav = document.getElementById("btnHomeNav");
  if(homeNav){
    homeNav.addEventListener("click", function(ev){
      ev.preventDefault();
      rgGoHome();
    });
  }

  $('#btnRefresh')?.addEventListener('click', ()=>location.reload());

  /* -------------------------------
   *  1) í”„ë¡œí•„
   * ------------------------------- */
  async function refreshProfile(){
    const me = await tryFetchJson(RG_AUTH_ME_URLS.concat(['/api/me','/users/me']));
    if(me){
      const user = me.user || me;
      setText('nick', user.nickname || user.name || user.username || '-');
      setText('email', user.email || '-');
      try{
        const joinedRaw = user.createdAt || user.joinedAt || user.created_at || "";
        const s = (joinedRaw || "").toString().slice(0,10);
        if(s) setText('joined', s);
      }catch(e){}
    }
  }

  /* -------------------------------
   *  2) ì§€ê°‘
   * ------------------------------- */
  function fmt(n){ return Number(n||0).toLocaleString('ko-KR'); }
  async function refreshWallet(){
    const wallet = await tryFetchJson(RG_WALLET_URLS);
    if(wallet){
      const coins  = wallet.coins ?? wallet.coin ?? wallet.points ?? 0;
      const xp     = wallet.xp    ?? wallet.exp  ?? wallet.experience ?? 0;
      const streak = wallet.streak ?? wallet.attendanceStreak ?? 0;
      setText('coins', fmt(coins));
      setText('xp', fmt(xp));
      setText('streak', streak);
    }
  }

  /* -------------------------------
   *  3) ì¸ë²¤í† ë¦¬
   * ------------------------------- */
  async function refreshInventory(){
    const inv = await tryFetchJson(RG_INV_URLS);
    const invBox = document.getElementById('inventory');
    if(!invBox) return;
    if(inv && Array.isArray(inv.items||inv.inventory)){
      const items = inv.items || inv.inventory;
      if(items.length){
        invBox.innerHTML = '<div class="list" id="invList"></div><div class="muted" style="margin-top:6px">* ì¼ë¶€ íš¨ê³¼ëŠ” ìë™ ì ìš©ë©ë‹ˆë‹¤.</div>';
        const list = document.getElementById('invList');
        for(const it of items){
          const row = document.createElement('div');
          row.className='row';
          row.innerHTML =
            '<div class="tag">'+(it.sku || it.code || it.name || 'item')+'</div>'+
            '<div>'+(it.title || it.label || it.name || '')+'</div>'+
            '<div class="muted">'+(it.qty ?? it.quantity ?? 1)+'ê°œ</div>';
          list.appendChild(row);
        }
      }
    }
  }

  /* -------------------------------
   *  4) íš¨ê³¼
   * ------------------------------- */
  async function refreshEffects(){
    const eff = await tryFetchJson(RG_EFF_URLS);
    const effBox = document.getElementById('effects');
    if(!effBox) return;
    if(eff && Array.isArray(eff.effects || eff.active)){
      const arr = eff.effects || eff.active;
      if(arr.length){
        effBox.innerHTML = '<div class="list" id="effList"></div>';
        const list = document.getElementById('effList');
        for(const e of arr){
          const row = document.createElement('div');
          row.className='row';
          row.innerHTML =
            '<div class="tag">'+(e.key || e.code || '-')+'</div>'+
            '<div>'+(e.title || e.name || '')+'</div>'+
            '<div class="muted">'+(e.multiplier ? (e.multiplier+"x") : '')+'</div>';
          list.appendChild(row);
        }
      }
    }
  }

  /* -------------------------------
   *  5) ìµœê·¼ ê²Œì„ ê¸°ë¡
   * ------------------------------- */
  async function refreshRuns(){
    const runs = await tryFetchJson(RG_RUNS_URLS);
    const tbody = document.querySelector('#runs tbody');
    if(!tbody) return;
    if(runs && Array.isArray(runs.items || runs.runs)){
      const arr = runs.items || runs.runs;
      if(arr.length){
        tbody.innerHTML='';
        for(const r of arr.slice(0,20)){
          const tr = document.createElement('tr');
          const playedRaw = (r.playedAt || r.createdAt || r.timestamp || '')+'';
          const playedStr = playedRaw ? playedRaw.slice(0,19).replace('T',' ') : '-';
          const durationSec = r.duration ? Math.round(r.duration/1000)+'s' : (r.playSeconds ? (r.playSeconds+'s') : '-');
          tr.innerHTML =
            '<td>'+(r.game || r.slug || r.title || '-')+'</td>'+
            '<td>'+(r.score ?? '-')+'</td>'+
            '<td>'+durationSec+'</td>'+
            '<td>'+playedStr+'</td>';
          tbody.appendChild(tr);
        }
      }else{
        tbody.innerHTML='<tr><td colspan="4" class="muted">ì•„ì§ ê²Œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
      }
    }
  }

  /* -------------------------------
   *  ì´ˆê¸° ë¡œë”©
   * ------------------------------- */
  await Promise.all([
    refreshProfile(),
    refreshWallet(),
    refreshInventory(),
    refreshEffects(),
    refreshRuns()
  ]);

  /* ------------------------------------------------------------------
   *  ğŸ”— ê²Œì„ ì—°ë™ ë¸Œë¦¿ì§€
   *  - ê° ê²Œì„ íŒŒì¼ì—ì„œ í˜¸ì¶œí•˜ëŠ” í›…ì„ ì—¬ê¸°ì„œ êµ¬í˜„
   *  - window.RG_addReward(gameId, payload)
   *  - window.gameStart(gameId)
   *  - window.gameFinish(gameId, finalScore)
   * ------------------------------------------------------------------ */

  // ë³´ìƒ ìˆ˜ì‹  í›…: ì§€ê°‘ + ê¸°ë¡ UI ê°±ì‹ 
  window.RG_addReward = function(gameId, payload){
    try{
      console.log("[RG][mypage] reward from game:", gameId, payload);
    }catch(e){}
    // ì„œë²„ì—ì„  ê° ê²Œì„ í˜ì´ì§€ì—ì„œ /api/wallet í˜¸ì¶œ ì™„ë£Œ.
    // ë§ˆì´í˜ì´ì§€ì—ì„œëŠ” ìµœì‹  ìƒíƒœë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì™€ UIë¥¼ ë™ê¸°í™”.
    refreshWallet();
    refreshRuns();
  };

  // ê²Œì„ ì‹œì‘ í›…: ë¶„ì„/ë¡œê·¸ìš© (ê°€ëŠ¥í•˜ë©´ ì„œë²„ë¡œ ì „ì†¡)
  window.gameStart = function(gameId){
    try{
      console.log("[RG][mypage] gameStart:", gameId);
    }catch(e){}
    // ì„ íƒ: ì„œë²„ ì´ë²¤íŠ¸ ì „ì†¡ (ì‹¤íŒ¨í•´ë„ ë¬´ì‹œ)
    (async function(){
      try{
        await tryFetchJson(RG_ANALYTICS_URLS, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          keepalive:true,
          body:JSON.stringify({ type:"game_start", game:gameId, ts:Date.now() })
        });
      }catch(e){}
    })();
  };

  // ê²Œì„ ì¢…ë£Œ í›…: ë¶„ì„ + ê¸°ë¡/ì§€ê°‘ ê°±ì‹ 
  window.gameFinish = function(gameId, finalScore){
    try{
      console.log("[RG][mypage] gameFinish:", gameId, finalScore);
    }catch(e){}
    (async function(){
      try{
        await tryFetchJson(RG_ANALYTICS_URLS, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          keepalive:true,
          body:JSON.stringify({ type:"game_finish", game:gameId, score:finalScore|0, ts:Date.now() })
        });
      }catch(e){}
      // ì¢…ë£Œ í›„ ìµœì‹  ì§€ê°‘/ê¸°ë¡ ë‹¤ì‹œ ì¡°íšŒ
      refreshWallet();
      refreshRuns();
    })();
  };

  console.log("[RG][mypage] ready.");
})();
</script>

  <div id="site-footer"></div>
</body>
</html>
