# wrangler.toml — Cloudflare Pages + Pages Functions (stable/minimal)
# Project: RETRO DB (static: /public, functions: /functions)

# 기본 Workers 설정
name = "retro-db"
compatibility_date = "2024-11-01"
# Node.js 내장 모듈(node:stream 등)을 사용하기 위한 호환 모드 설정
compatibility_flags = ["nodejs_compat"]

# ✅ Pages용 정적 파일 출력 디렉터리 (최상단 전역 키여야 함)
pages_build_output_dir = "public"

# ✅ 빌드 시 node_modules 설치
[build]
command = "npm install"

# ✅ Functions 번들을 modules 형식으로 업로드
[build.upload]
format = "modules"

# Notes:
# - DO NOT add Workers-only or legacy keys (main, routes, workers_dev, triggers, [site], etc.)
# - Functions are auto-detected from /functions at repo root; no extra config needed
# - In Cloudflare Pages dashboard, set Output directory = "public"
# - Root directory in Cloudflare Pages settings should remain the repo root (empty)
# - No extra build command is required for static hosting from `public/`, but
#   here we run `npm install` so that server-side dependencies (e.g. Neon) are available.
# - `nodejs_compat` 플래그로 node:stream 등 일부 Node API를 Functions에서 사용할 수 있습니다.
# - 추가 Node 기능 사용 시에는 Cloudflare Workers 호환성 문서를 함께 참고하세요.
