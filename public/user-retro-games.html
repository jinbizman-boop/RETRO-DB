<!DOCTYPE html>
<html lang="ko" data-env="prod">
<head>
  <!--#include file="/partials/head-seo.html" -->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <!-- Google AdSense ì†Œìœ ê¶Œ í™•ì¸ ë©”íƒ€ íƒœê·¸ -->
  <meta name="google-adsense-account" content="ca-pub-6713974265397310" />
  <title>RETRO GAMES â€“ Neon Home (Logged-in)</title>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6713974265397310"
    crossorigin="anonymous"></script>

  <style>
    :root{
      --gold1:#ffdf6e;
      --gold2:#ffb84d;
      --blue1:#2b7bff;
      --blue2:#0048ff;
      --bg:#0b001e;
      --gapY:24px;

      /* ì•ˆì „ ì—¬ë°±(ë…¸ì¹˜) */
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    *{box-sizing:border-box}

    html,body{
      height:100%;
      margin:0;
      background:radial-gradient(circle at 40% -10%,#320076,#0b001e 70%);
      font-family:'Segoe UI',system-ui,Apple SD Gothic Neo,sans-serif;
      color:#fff;
      -webkit-text-size-adjust:100%;
      text-size-adjust:100%;
    }

    body{
      padding:var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);
    }

    .wrap{
      min-height:100%;
      display:grid;
      grid-template-rows:auto 1fr auto;
    }

    /* Header ê¸°ë³¸ ë ˆì´ì•„ì›ƒ (ë°ìŠ¤í¬í†± ê¸°ì¤€) */
    header{
      position:relative;
      text-align:center;
      padding:22px 18px;
      display:block;
    }
    .title{
      font-size:clamp(28px,3.2vw,36px);
      font-weight:900;
      letter-spacing:.5px;
      color:var(--gold1);
      text-shadow:0 0 18px var(--gold2);
    }
    .subtitle{
      opacity:.9;
      margin:0;
      text-align:center;
      margin-bottom:6px;
      font-size:clamp(13px,1.6vw,16px);
    }
    /* ë¡œê·¸ì¸ ì‚¬ìš©ì í™˜ì˜ ë¬¸êµ¬ (ê¸°ë³¸ subtitle ìŠ¤íƒ€ì¼ì— ì‚´ì§ ë³´ì¡° ëŠë‚Œ) */
    .subtitle.user-greeting{
      opacity:.85;
      font-size:clamp(12px,1.4vw,15px);
      margin-top:2px;
      margin-bottom:4px;
    }

    /* ì¢Œì¸¡ HUD */
    .hudTop{
      position:absolute;
      left:40px;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      flex-wrap:wrap;
      gap:8px 8px;
      align-items:center;
      justify-content:flex-start;
      max-width:60vw;
    }

    /* ìš°ì¸¡ ì„¤ì • ë²„íŠ¼ */
    .auth{
      position:absolute;
      right:40px;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
    }
    .authbtn{
      padding:8px 14px;
      border-radius:12px;
      border:1px solid #3e2b7b;
      background:linear-gradient(180deg,#1a2b7a,#0a1a64);
      font-weight:900;
      color:#e9f0ff;
      box-shadow:0 6px 12px #0006;
      cursor:pointer;
      font-size:13px;
      white-space:nowrap;
    }
    .authbtn.alt{display:none;}

    /* Main ì˜ì—­ */
    .content{
      width:100%;
      display:flex;
      justify-content:center;
    }

    main{
      max-width:1200px;
      width:100%;
      margin:0 auto;
      padding:0 22px 12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:0;
      min-height:0;
    }

    .stack{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:18px;
      transform:translateY(-36px);
      width:100%;
    }

    /* Pill HUD */
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:16px;
      background:linear-gradient(180deg,#0c1430,#0a0f26);
      border:1px solid #3857bd;
      box-shadow:0 6px 16px #0008,inset 0 0 18px #102265;
      white-space:nowrap;
    }
    .pill .icon{
      width:22px;
      height:22px;
      display:grid;
      place-items:center;
      border-radius:50%;
      /* ì—¬ê¸° ìˆ˜ì •: #3a7fff â†’ #3a7bff */
      background:radial-gradient(circle at 30% 30%,#8bb3ff,#3a7bff);
      box-shadow:0 0 10px #6fb0ffaa;
      font-size:14px;
    }
    .pill .label{
      font-weight:900;
      letter-spacing:.3px;
    }
    /* SHOP / RANKING ë¼ë²¨ë„ COINS / XPì™€ ë™ì¼í•œ ê³¨ë“œ ìƒ‰ìƒ ì ìš© */
    .pill.shop .label,
    .pill.rank .label{
      color:#ffe9a3;
      text-shadow:0 0 8px #ffd86a;
    }
    .amount{
      font-size:18px;
      color:#ffe9a3;
      text-shadow:0 0 8px #ffd86a;
    }
    .unit{
      opacity:.8;
      margin-left:2px;
      font-size:12px;
    }

    /* ì ‘ê·¼ì„±ìš© ìˆ¨ê¹€ í…ìŠ¤íŠ¸ */
    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }

    /* í™©ê¸ˆ ë¦¬ë³¸ ë²„íŠ¼ */
    .ctaWrap{
      display:flex;
      justify-content:center;
      margin:0;
      width:100%;
    }
    .goldBtn{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:22px 64px;
      min-width:min(72vw,720px);
      max-width:100%;
      border:none;
      border-radius:14px;
      cursor:pointer;
      background:radial-gradient(120% 200% at 50% -80%, #fff6b0 0%, #ffd24a 38%, #ffb320 68%, #f39a15 100%),linear-gradient(180deg,#ffe889 0%,#ffc83d 40%,#ffb020 100%);
      box-shadow:0 10px 18px rgba(0,0,0,.38),inset 0 6px 14px rgba(255,255,255,.55),inset 0 -12px 18px rgba(176,88,0,.45);
      isolation:isolate;
      transform:translateZ(0);
    }
    .goldBtn::before,
    .goldBtn::after{
      content:"";
      position:absolute;
      top:50%;
      width:110px;
      height:34px;
      margin-top:-10px;
      background:linear-gradient(180deg,#ffd870 0%,#f2a41b 85%),linear-gradient(180deg,#ffec9c,#ffcf47);
      box-shadow:0 8px 12px rgba(0,0,0,.25), inset 0 -8px 10px rgba(140,70,0,.35);
      z-index:-1;
    }
    .goldBtn::before{
      left:-64px;
      border-radius:6px 0 6px 6px;
      transform:skewX(-18deg);
    }
    .goldBtn::after{
      right:-64px;
      border-radius:0 6px 6px 6px;
      transform:skewX(18deg);
    }
    .goldBtn span{
      background:linear-gradient(180deg,#fffef2,#fffbe2);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      font-weight:900;
      font-size:26px;
      letter-spacing:.3px;
      text-shadow:0 0 12px rgba(255,255,200,.9),0 0 24px rgba(255,230,150,.75);
      white-space:nowrap;
    }
    .goldBtn:hover{
      transform:translateY(-2px);
    }
    .goldBtn:hover,
    .goldBtn:focus-visible{
      box-shadow:0 14px 22px rgba(0,0,0,.42),inset 0 7px 16px rgba(255,255,255,.6),inset 0 -14px 20px rgba(176,88,0,.5);
      outline:2px solid rgba(255,220,120,.6);
      outline-offset:2px;
    }

    /* ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
    .rowTop{
      display:flex;
      justify-content:center;
      align-items:stretch;
      gap:28px;
      flex-wrap:nowrap;
      overflow-x:auto;
      -webkit-overflow-scrolling:touch;
      margin-top:8px;
      padding-bottom:6px;
      scrollbar-width:none;
      width:100%;
    }
    .rowTop::-webkit-scrollbar{display:none;}

    .card{
      flex:0 0 clamp(190px, 28vw, 220px);
      width:clamp(190px, 28vw, 220px);
      height:300px;
      display:grid;
      grid-template-rows:120px 44px 1fr 54px;
      background:linear-gradient(180deg,#0a0030,#000);
      border:3px solid #3e2b7b;
      border-radius:22px;
      box-shadow:0 0 30px #0008,inset 0 0 20px #2a0085;
      padding:16px 14px;
      cursor:pointer;
      transition:box-shadow .14s ease, transform .12s ease;
      text-align:center;
    }
    .card:hover{
      box-shadow:0 0 36px #007affaa,inset 0 0 26px #001a44;
      transform:translateY(-3px);
    }

    .thumb{
      display:grid;
      place-items:center;
      width:100%;
      height:100%;
    }
    .card h3{
      margin:6px 0 0;
      font-size:18px;
      font-weight:800;
      color:var(--gold1);
      text-shadow:0 0 10px #bf8;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .meta{
      font-size:11px;
      opacity:.85;
      padding:0 6px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
    }
    .btnbar{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .btn{
      flex:1;
      height:38px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border-radius:12px;
      border:1px solid #2d3690;
      background:linear-gradient(180deg,#1a2b7a,#0a1a64);
      font-weight:800;
      color:#e9f0ff;
      box-shadow:0 6px 12px #0006;
      font-size:12px;
    }
    .btn:hover{filter:brightness(1.06);}

    /* ê´‘ê³  ë°°ë„ˆ (728x90 ë¦¬ë”ë³´ë“œ ê·œê²©) */
    .adBanner{
      width:100%;
      display:flex;
      justify-content:center;
      margin-top:8px;
    }
    .adBanner-inner{
      width:728px;
      height:90px;
      max-width:100%;
      padding:10px 14px;
      border-radius:18px;
      border:1px solid #3250c2;
      background:linear-gradient(90deg,#0b1640,#12296f 40%,#1b3ea0 80%,#233fd0);
      box-shadow:0 8px 20px rgba(0,0,0,.65),0 0 22px rgba(40,120,255,.55);
      display:flex;
      align-items:center;
      gap:12px;
      text-decoration:none;
      color:#e9f0ff;
      cursor:pointer;
      box-sizing:border-box;
    }
    .adBadge{
      padding:4px 10px;
      border-radius:999px;
      font-size:10px;
      font-weight:900;
      letter-spacing:.8px;
      text-transform:uppercase;
      background:linear-gradient(180deg,#ffdf6e,#ffb84d);
      color:#3a2400;
      box-shadow:0 0 10px rgba(255,230,150,.75);
      flex-shrink:0;
    }
    .adTextWrap{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width:0;
    }
    .adTitle{
      font-size:13px;
      font-weight:800;
      color:#fff9da;
      text-shadow:0 0 8px rgba(255,220,140,.9);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .adDesc{
      font-size:11px;
      opacity:.9;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .adBanner-inner:hover{
      filter:brightness(1.06);
      box-shadow:0 10px 24px rgba(0,0,0,.75),0 0 26px rgba(60,140,255,.8);
    }

    footer{
      padding:12px 16px;
      text-align:center;
      color:#aab;
      opacity:.9;
      font-size:12px;
      margin-top:var(--gapY);
    }

    #fx{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.5;
    }

    .divider{
      height:4px;
      width:100%;
      background:linear-gradient(90deg,transparent,rgba(0,136,255,.8),transparent);
      filter:blur(1px);
      box-shadow:0 0 18px #0088ff88;
      margin:0;
    }

    /* ë°˜ì‘í˜• ë³´ì™„ */

    @media (max-width:1200px){
      .hudTop{left:18px;gap:8px;}
    }

    @media (max-width:1024px){
      .auth{right:18px;}
      .rowTop{gap:24px;}
      .stack{transform:translateY(-24px);}
      .goldBtn{min-width:min(84vw,720px);}
    }

    /* íƒœë¸”ë¦¿ / ì‘ì€ ë…¸íŠ¸ë¶: í—¤ë” ìš”ì†Œê°€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ì¬ë°°ì¹˜ */
    @media (max-width:860px){
      header{
        padding-top:calc(16px + var(--safe-top));
        padding-bottom:16px;
      }
      .hudTop,
      .auth{
        position:static;
        transform:none;
        max-width:100%;
      }
      .hudTop{
        justify-content:center;
        margin-top:10px;
      }
      .auth{
        justify-content:center;
        margin-top:6px;
      }
      .title{
        font-size:clamp(24px,6vw,30px);
      }
      .subtitle{
        margin-top:4px;
      }
    }

    @media (max-width:680px){
      .stack{transform:translateY(-16px);}
      .goldBtn{
        min-width:min(92vw,640px);
        padding:18px 52px;
      }
      .goldBtn span{
        font-size:22px;
        letter-spacing:.2px;
      }
      .goldBtn::before{
        left:-52px;
        width:90px;
        height:30px;
      }
      .goldBtn::after{
        right:-52px;
        width:90px;
        height:30px;
      }
      .card{
        flex:0 0 72vw;
        width:72vw;
        max-width:260px;
      }
    }

    @media (max-width:480px){
      main{
        padding:0 14px 10px;
      }
      .rowTop{
        gap:20px;
      }
      .card{
        flex:0 0 78vw;
        width:78vw;
      }
      .pill{
        padding:6px 10px;
      }
      .amount{
        font-size:16px;
      }
      .adBanner-inner{
        padding:10px 12px;
      }
      .adTitle{
        font-size:12px;
      }
      .adDesc{
        font-size:10px;
      }
    }

    /* ë°ìŠ¤í¬í†±(ë„“ì€ í™”ë©´)ì—ì„œ ì¹´ë“œ 5ê°œë¥¼ ì»¨í…Œì´ë„ˆ ì•ˆì— ê· ë“± ì •ë ¬í•˜ê¸° ìœ„í•œ ë³´ì • */
    @media (min-width:1024px){
      .rowTop{
        display:grid;
        grid-template-columns:repeat(5,minmax(0,1fr));
        gap:28px;
        justify-content:center;
        align-items:stretch;
        overflow:visible; /* ë°ìŠ¤í¬í†±ì—ì„œëŠ” ê°€ë¡œ ìŠ¤í¬ë¡¤ ë¶ˆí•„ìš” */
      }
      .rowTop .card{
        flex:none;
        width:100%;
        max-width:none;
      }
    }

    .cookie-banner{
      position:fixed;
      left:12px;
      right:12px;
      bottom:12px;
      display:none;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #2b3f8f;
      background:linear-gradient(180deg,#0b1f40,#0a1730);
      box-shadow:0 10px 18px rgba(0,0,0,.45),inset 0 0 18px rgba(255,255,255,.05);
      z-index:10000;
      font-size:12px;
    }
    .cookie-banner .spacer{flex:1;}
    .cookie-banner button{
      padding:8px 12px;
      border-radius:10px;
      border:1px solid #2d3690;
      background:linear-gradient(180deg,#1a2b7a,#0a1a64);
      font-weight:800;
      color:#e9f0ff;
      cursor:pointer;
    }
    .cookie-banner .agree{
      background:linear-gradient(180deg,#ffdf6e,#ffb84d);
      color:#3a2400;
      border-color:#7a5600;
    }

    /* ë­í‚¹ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .rank-modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.65);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9000;
    }
    .rank-modal-backdrop.open{
      display:flex;
    }
    .rank-modal{
      width:min(960px,94vw);
      max-height:80vh;
      border-radius:22px;
      background:radial-gradient(circle at 10% -30%,#3c2b80,#050015 70%);
      box-shadow:0 0 40px rgba(0,0,0,.8),0 0 40px rgba(60,100,255,.7);
      border:2px solid #3e2b7b;
      padding:18px 20px 18px;
      display:flex;
      flex-direction:column;
    }
    .rank-modal-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .rank-modal-title-wrap{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .rank-modal-title{
      font-size:18px;
      font-weight:900;
      color:var(--gold1);
      text-shadow:0 0 12px #ffdc7a;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .rank-modal-sub{
      font-size:12px;
      opacity:.8;
    }
    .rank-modal-close{
      border-radius:999px;
      border:1px solid #3040a8;
      background:linear-gradient(180deg,#1b2b7f,#0b164f);
      color:#e9f0ff;
      font-size:13px;
      font-weight:800;
      padding:6px 10px;
      cursor:pointer;
      white-space:nowrap;
      box-shadow:0 4px 10px rgba(0,0,0,.5);
    }
    .rank-modal-close:hover{
      filter:brightness(1.05);
    }

    .rank-game-tabs{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:10px;
    }
    .rank-game-tab{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid #3240a8;
      background:linear-gradient(180deg,#0d1638,#060c24);
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      opacity:.78;
    }
    .rank-game-tab span.code{
      font-weight:800;
      margin-right:4px;
      color:#ffdf6e;
    }
    .rank-game-tab.active{
      background:linear-gradient(180deg,#ffdf6e,#ffb84d);
      color:#321c00;
      border-color:#7a5600;
      text-shadow:0 0 6px rgba(255,240,160,.8);
      opacity:1;
    }

    .rank-table-wrap{
      flex:1;
      min-height:200px;
      margin-top:4px;
      border-radius:14px;
      border:1px solid #263472;
      background:linear-gradient(180deg,#05081b,#050314);
      box-shadow:0 0 18px rgba(0,0,0,.7) inset;
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .rank-table-head,
    .rank-table-body{
      width:100%;
    }
    .rank-table-head{
      border-bottom:1px solid #27336b;
      background:linear-gradient(180deg,#10193a,#090e22);
    }
    .rank-table-row{
      display:grid;
      grid-template-columns:40px 1.4fr .7fr 1fr 1fr 1.5fr;
      align-items:center;
      font-size:11px;
      padding:6px 12px;
      column-gap:6px;
      white-space:nowrap;
    }
    .rank-table-head .rank-table-row{
      font-weight:800;
      font-size:11px;
      text-transform:uppercase;
      letter-spacing:.3px;
      color:#d6e0ff;
    }
    .rank-table-body{
      flex:1;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    .rank-table-body .rank-table-row:nth-child(2n){
      background:rgba(255,255,255,.02);
    }
    .rank-table-cell-rank{
      font-weight:800;
      color:#ffdf6e;
      text-shadow:0 0 6px rgba(255,230,150,.7);
    }
    .rank-table-cell-user{
      font-weight:700;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .rank-table-cell-gender{
      text-transform:uppercase;
      opacity:.85;
    }
    .rank-table-cell-score,
    .rank-table-cell-points{
      text-align:right;
      font-variant-numeric:tabular-nums;
    }
    .rank-table-cell-time{
      font-variant-numeric:tabular-nums;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .rank-table-empty{
      padding:16px 14px;
      font-size:12px;
      text-align:center;
      opacity:.85;
    }
    .rank-table-loading{
      padding:16px 14px;
      font-size:12px;
      text-align:center;
      opacity:.9;
      color:#ffd86a;
    }

    .rank-modal-footer{
      margin-top:8px;
      font-size:11px;
      opacity:.75;
      display:flex;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }
    .rank-modal-footer span.badge{
      padding:3px 8px;
      border-radius:999px;
      border:1px solid #3240a8;
      background:linear-gradient(180deg,#0b1337,#05091f);
      font-size:10px;
      text-transform:uppercase;
      letter-spacing:.2px;
      opacity:.9;
    }

    @media (max-width:640px){
      .rank-modal{
        padding:14px 12px 14px;
        max-height:86vh;
      }
      .rank-table-row{
        grid-template-columns:32px 1.4fr .7fr 1fr 1fr 1.7fr;
        padding:5px 8px;
        column-gap:4px;
        font-size:10px;
      }
      .rank-table-head .rank-table-row{
        font-size:10px;
      }
    }

    /* layout notes:
       - flex ê¸°ë°˜ ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ìœ ì§€
       - ë°ìŠ¤í¬í†±ì—ì„œ gridë¡œ 5ë“±ë¶„ ì •ë ¬, ì¹´ë“œ ì´íƒˆ ë°©ì§€
       - ê¸°ì¡´ ìƒ‰ìƒ/ê·¸ë¼ë°ì´ì…˜/ì„€ë„ìš° ë“± ì‹œê° ìŠ¤íƒ€ì¼ì€ ëª¨ë‘ ìœ ì§€ */
  </style>
</head>

<!-- í”„ë¡œì íŠ¸ ì „ì—­ API (ëª¨ë“ˆ ì•„ë‹˜) -->
<script defer src="assets/js/app.js"></script>
<script defer src="assets/js/analytics.js"></script>

<body>
  <!--#include file="/partials/header.html" -->
  <canvas id="fx"></canvas>

  <div class="wrap">
    <header>
      <!-- ì¢Œì¸¡: HUD -->
      <div class="hudTop" aria-label="ë³´ìƒ í˜„í™©">
        <div class="pill coins" title="ë³´ìœ  ì½”ì¸">
          <div class="icon">ğŸª™</div>
          <div id="coinVal" class="amount">0</div>
          <div class="unit">COINS</div>
        </div>
        <div class="pill xp" title="ê²½í—˜ì¹˜">
          <div class="icon">ğŸ†</div>
          <div id="xpVal" class="amount">0</div>
          <div class="unit">XP</div>
          <span id="xpCap" class="sr-only">/ 20K</span>
          <span class="sr-only" aria-hidden="true"><span id="xpBar"></span></span>
        </div>
        <!-- SHOP ì´ë™ ë²„íŠ¼(ë””ìì¸ ìœ ì§€) -->
        <button class="pill shop" onclick="goShop()" title="ìƒì ">
          <div class="icon">ğŸ›ï¸</div>
          <div class="label">SHOP</div>
        </button>
        <!-- RANKING ë²„íŠ¼ (SHOP ì˜¤ë¥¸ìª½, ë™ì¼ ê·œê²©) -->
        <button class="pill rank" onclick="openRankingModal()" title="ì‹¤ì‹œê°„ ë­í‚¹">
          <div class="icon">ğŸ…</div>
          <div class="label">RANKING</div>
        </button>
      </div>

      <div class="title">ğŸ® RETRO GAMES</div>
      <div class="subtitle">ì˜¤ëŠ˜ì˜ ë¯¸ë‹ˆê²Œì„ì„ ì„ íƒí•˜ì„¸ìš”!</div>
      <!-- ë¡œê·¸ì¸ ì‚¬ìš©ì ì´ë¦„/ë‹‰ë„¤ì„ í‘œì‹œ -->
      <div id="userGreeting" class="subtitle user-greeting" aria-live="polite"></div>

      <!-- ìš°ì¸¡: ì„¤ì • -->
      <div class="auth">
        <button class="authbtn" type="button" onclick="alert('ì„¤ì • ì—´ê¸°(ì‘ì—…ì˜ˆì •)')">âš™ï¸ ì„¤ì •</button>
      </div>
    </header>

    <div class="divider"></div>

    <section class="content">
      <main>
        <div class="stack">
          <!-- ì˜¤ëŠ˜ì˜ í–‰ìš´ -->
          <div class="ctaWrap">
            <div
              class="goldBtn"
              role="button"
              tabindex="0"
              onclick="goLucky()"
              onkeypress="if(event.key==='Enter') goLucky()"
              aria-label="ì˜¤ëŠ˜ì˜ í–‰ìš´ ë½‘ê¸°"
            >
              <span>ì˜¤ëŠ˜ì˜ í–‰ìš´ ë½‘ê¸°</span>
            </div>
          </div>

          <!-- ê²Œì„ ì¹´ë“œ -->
          <div class="rowTop">
            <div class="card" onclick="goGame('2048')">
              <div class="thumb">
                <svg width="80" height="80" viewBox="0 0 120 120">
                  <rect x="12" y="12" width="96" height="96" rx="18" fill="#7a9cff"/>
                  <text x="60" y="78" text-anchor="middle" font-size="46" font-family="system-ui,Segoe UI" font-weight="900" fill="#0b1a3f">2048</text>
                </svg>
              </div>
              <h3>2048</h3>
              <div class="meta">ë‚œì´ë„ 1â€“100 Â· ë³´ë“œ 4Ã—4~6Ã—6</div>
              <div class="btnbar"><div class="btn">PLAY</div></div>
            </div>

            <div class="card" onclick="goGame('brick-breaker')">
              <div class="thumb">
                <svg width="90" height="80" viewBox="0 0 130 120">
                  <rect x="14" y="20" width="102" height="18" rx="8" fill="#8ea3ff"/>
                  <rect x="14" y="44" width="102" height="18" rx="8" fill="#c4ceff"/>
                  <rect x="48" y="88" width="60" height="10" rx="5" fill="#70ffa8"/>
                  <circle cx="42" cy="74" r="7" fill="#ffd166"/>
                </svg>
              </div>
              <h3>Brick Breaker</h3>
              <div class="meta">í”„ë¦¬ì…‹/íŠ¹ìˆ˜ë³¼/ë¦¬í”Œë ˆì´</div>
              <div class="btnbar"><div class="btn">PLAY</div></div>
            </div>

            <div class="card" onclick="goGame('retro-match')">
              <div class="thumb">
                <svg width="80" height="80" viewBox="0 0 120 120">
                  <rect x="18" y="22" width="28" height="28" rx="6" fill="#ff9aa6"/>
                  <rect x="46" y="22" width="28" height="28" rx="6" fill="#92ff9a"/>
                  <rect x="74" y="22" width="28" height="28" rx="6" fill="#7ad7ff"/>
                </svg>
              </div>
              <h3>Retro Match</h3>
              <div class="meta">íƒ€ì„ ì–´íƒ Â· íŠ¹ìˆ˜ íƒ€ì¼</div>
              <div class="btnbar"><div class="btn">PLAY</div></div>
            </div>

            <div class="card" onclick="goGame('retro-running')">
              <div class="thumb">
                <svg width="80" height="80" viewBox="0 0 120 120">
                  <rect x="16" y="84" width="88" height="8" fill="#6ec36e"/>
                  <circle cx="52" cy="46" r="10" fill="#ffddea"/>
                </svg>
              </div>
              <h3>Retro Runner</h3>
              <div class="meta">2ë‹¨ ì í”„ Â· ì•„ì´í…œ Â· ë‚®/ë°¤</div>
              <div class="btnbar"><div class="btn">PLAY</div></div>
            </div>

            <div class="card" onclick="goGame('tetris')">
              <div class="thumb">
                <svg width="80" height="80" viewBox="0 0 120 120">
                  <rect x="18" y="60" width="24" height="24" fill="#7ad7ff"/>
                  <rect x="42" y="60" width="24" height="24" fill="#ffe17a"/>
                  <rect x="66" y="60" width="24" height="24" fill="#caa5ff"/>
                  <rect x="42" y="36" width="24" height="24" fill="#92ff9a"/>
                </svg>
              </div>
              <h3>Tetris</h3>
              <div class="meta">í™€ë“œ/ë„¥ìŠ¤íŠ¸ Â· ê°€ë¹„ì§€ ë¼ì¸</div>
              <div class="btnbar"><div class="btn">PLAY</div></div>
            </div>
          </div>

          <!-- ê°€ë¡œí˜• ê´‘ê³  ë°°ë„ˆ (728x90) -->
          <div class="adBanner" aria-label="ê´‘ê³  ë°°ë„ˆ">
            <a href="#" class="adBanner-inner">
              <span class="adBadge">AD</span>
              <div class="adTextWrap">
                <span class="adTitle">RETRO GAMES ìŠ¤í°ì„œ ë°°ë„ˆ ì˜ì—­</span>
                <span class="adDesc">ì´ ê³µê°„ì— íŒŒíŠ¸ë„ˆì‚¬ ì´ë²¤íŠ¸/í”„ë¡œëª¨ì…˜ ì´ë¯¸ì§€ ë˜ëŠ” ë§í¬ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</span>
              </div>
            </a>
          </div>
        </div>
      </main>
    </section>

    <div class="divider"></div>
    <footer>Â©2025 ì§„ë¹„ì¦ˆ ë§¤ë‹ˆì§€ë¨¼íŠ¸ â”ƒ ê´‘ê³ ë¬¸ì˜ jinbizman@gmail.com â”ƒ RETRO GAMES Â· Neon UI â”ƒ MADE BY ONLY OPEN AI</footer>
  </div>

  <!-- ë­í‚¹ ëª¨ë‹¬ -->
  <div id="rankModalBackdrop" class="rank-modal-backdrop" aria-hidden="true">
    <div class="rank-modal" role="dialog" aria-modal="true" aria-labelledby="rankModalTitle">
      <div class="rank-modal-header">
        <div class="rank-modal-title-wrap">
          <div id="rankModalTitle" class="rank-modal-title">
            <span>ğŸ… ì‹¤ì‹œê°„ ê²Œì„ ë­í‚¹</span>
            <span id="rankModalGameLabel" style="font-size:13px;opacity:.9;"></span>
          </div>
          <div class="rank-modal-sub">
            ê° ê²Œì„ë³„ ìƒìœ„ 1ìœ„ ~ 100ìœ„ê¹Œì§€ ìœ ì € ì•„ì´ë””, ì„±ë³„, ìŠ¤ì½”ì–´, í¬ì¸íŠ¸, ë‹¬ì„± ì‹œê°„ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>
        <button type="button" class="rank-modal-close" onclick="closeRankingModal()">ë‹«ê¸° âœ•</button>
      </div>

      <div class="rank-game-tabs" id="rankGameTabs" role="tablist" aria-label="ê²Œì„ ì„ íƒ">
        <!-- JSì—ì„œ íƒ­ ìë™ ìƒì„± -->
      </div>

      <div class="rank-table-wrap">
        <div class="rank-table-head">
          <div class="rank-table-row">
            <div>#</div>
            <div>ìœ ì € ì•„ì´ë””</div>
            <div>ì„±ë³„</div>
            <div>ìŠ¤ì½”ì–´</div>
            <div>í¬ì¸íŠ¸</div>
            <div>ë‹¬ì„± ì‹œê°„</div>
          </div>
        </div>
        <div class="rank-table-body" id="rankTableBody">
          <div class="rank-table-loading" id="rankTableLoading">ê²Œì„ ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
      </div>

      <div class="rank-modal-footer">
        <span class="badge">Top 100</span>
        <span>â€» ë°ì´í„° ì œê³µ: RETRO GAMES ë¦¬ë”ë³´ë“œ API Â· ìƒˆë¡œê³ ì¹¨ ì‹œ ìµœì‹  ì •ë³´ë¡œ ê°±ì‹ ë©ë‹ˆë‹¤.</span>
      </div>
    </div>
  </div>

  <script>
    const BASE = "/";
    const AUTH_API_BASE = "/api/auth";
    const LEADERBOARD_API_BASE = "/api/leaderboard";

    /* ê²½ë¡œ ë§¤í•‘ */
    const GAME = {
      "2048":           BASE + "games/2048.html",
      "brick-breaker":  BASE + "games/brick-breaker.html",
      // ğŸ‘‡ brick-match ì˜› ë§í¬ë„ retro-match.htmlë¡œ ì—´ë¦¬ë„ë¡ alias ì²˜ë¦¬
      "brick-match":    BASE + "games/retro-match.html",
      "retro-match":    BASE + "games/retro-match.html", // ë³„ë„ HTML
      "retro-running":  BASE + "games/retro-running.html",
      "tetris":         BASE + "games/tetris.html"
    };
    const LUCKY = BASE + "features/today-lucky.html";

    function goGame(slug){
      if (GAME[slug]) window.location.href = GAME[slug];
    }
    function goLucky(){
      window.location.href = LUCKY;
    }
    function goShop(){
      window.location.href = BASE + "shop.html";
    }

    /* ë³´ìƒ ì§‘ê³„ (coins/tickets/xp) */
    const NUM = n => Number.isFinite(+n) ? +n : 0;

    function readTotals(){
      return {
        coins:   NUM(localStorage.getItem('rg_coins')   || 0),
        tickets: NUM(localStorage.getItem('rg_tickets') || 0),
        xp:      NUM(localStorage.getItem('rg_xp')      || 0),
        xpCap:   NUM(localStorage.getItem('rg_xp_cap')  || 20000)
      };
    }

    function writeTotals(t){
      localStorage.setItem('rg_coins',   t.coins);
      localStorage.setItem('rg_tickets', t.tickets);
      localStorage.setItem('rg_xp',      t.xp);
      localStorage.setItem('rg_xp_cap',  t.xpCap);
    }

    function addReward({coins=0,tickets=0,xp=0}={}){
      const t = readTotals();
      t.coins   += NUM(coins);
      t.tickets += NUM(tickets);
      t.xp      += NUM(xp);
      writeTotals(t);
      renderHUD();
    }

    /* HUD ë Œë”ë§ */
    function fmt(n){ return Number(n).toLocaleString('en-US'); }

    function renderHUD(){
      const t = readTotals();
      const coinEl = document.getElementById('coinVal');
      const xpEl   = document.getElementById('xpVal');
      if (coinEl) coinEl.textContent = fmt(t.coins);
      if (xpEl)   xpEl.textContent   = fmt(t.xp);

      const pct = Math.max(0, Math.min(100, (t.xp / Math.max(1,t.xpCap)) * 100));
      const xpBar = document.getElementById('xpBar');
      if (xpBar) xpBar.style.width = pct + "%";
      const xpCap = document.getElementById('xpCap');
      if (xpCap) xpCap.textContent = "/ " + (t.xpCap >= 1000 ? fmt(t.xpCap/1000)+"K" : fmt(t.xpCap));
    }

    renderHUD();
    window.addEventListener('storage', e=>{
      if(['rg_coins','rg_tickets','rg_xp','rg_xp_cap'].includes(e.key)) renderHUD();
    });

    /* ë¡œê·¸ì¸ ìƒíƒœ / ì‚¬ìš©ì ì •ë³´ í™•ì¸ (ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì œê±° ë²„ì „) */
    function redirectToLogin(){
      // í˜„ì¬ëŠ” ìë™ìœ¼ë¡œ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ (í•„ìš” ì‹œ ë‹¤ë¥¸ ë²„íŠ¼/ë§í¬ì—ì„œ ìˆ˜ë™ í˜¸ì¶œìš©)
      try{
        const next = encodeURIComponent(location.pathname + location.search);
        window.location.href = BASE + "login.html?next=" + next;
      }catch(e){
        window.location.href = BASE + "login.html";
      }
    }

    function updateUserGreeting(user){
      try{
        const el = document.getElementById("userGreeting");
        if(!el) return;
        if(!user){
          el.textContent = "";
          return;
        }
        const name =
          user.username ||
          user.name ||
          (user.email ? String(user.email).split("@")[0] : "") ||
          "";
        if(!name){
          el.textContent = "";
          return;
        }
        el.textContent = name + " ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!";
      }catch(e){
        console.error("user greeting error", e);
      }
    }

    // ë¡œê·¸ì¸ ì²´í¬ëŠ” í•˜ì§€ë§Œ ì‹¤íŒ¨í•´ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë³´ë‚´ì§€ ì•Šê³  ì¡°ìš©íˆ ë¬´ì‹œ
    window.ensureLoggedIn = async function ensureLoggedIn(){
      try{
        const res = await fetch(AUTH_API_BASE + "/me", {
          method: "GET",
          credentials: "include",
          headers: {
            "Accept": "application/json",
            "Cache-Control": "no-store"
          }
        });

        if(!res.ok){
          // ë¹„ë¡œê·¸ì¸/ì˜¤ë¥˜ â†’ ê²Œì„ì€ ê·¸ëŒ€ë¡œ, í™˜ì˜ ë¬¸êµ¬ë§Œ ë¹„ì›€
          updateUserGreeting(null);
          return;
        }

        let data = null;
        try{
          data = await res.json();
        }catch(_){}

        if(!data || !data.ok || !data.user){
          updateUserGreeting(null);
          return;
        }

        // ì „ì—­ì— ë³´ê´€ (í•„ìš”ì‹œ ë‹¤ë¥¸ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í™œìš© ê°€ëŠ¥)
        window.__RG_CURRENT_USER__ = data.user;
        updateUserGreeting(data.user);
      }catch(err){
        console.error("auth check error", err);
        updateUserGreeting(null);
      }
    };

    // URL íŒŒë¼ë¯¸í„° ë³´ìƒ (?coins=&tickets=&xp=)
    (function consumeQueryReward(){
      const p = new URLSearchParams(location.search);
      const c = NUM(p.get('coins'));
      const tk = NUM(p.get('tickets'));
      const x = NUM(p.get('xp'));
      if (c || tk || x){
        addReward({coins:c,tickets:tk,xp:x});
        history.replaceState({}, "", location.pathname);
      }
    })();

    // localStorage í ë³´ìƒ (rg_reward)
    (function consumeQueuedReward(){
      const raw = localStorage.getItem('rg_reward');
      if(!raw) return;
      try{
        const r = JSON.parse(raw)||{};
        if (r && (r.coins||r.tickets||r.xp)) addReward(r);
      }catch(e){}
      localStorage.removeItem('rg_reward');
    })();

    // í˜ì´ì§€ ì§„ì… ì‹œ: ë¡œê·¸ì¸ ì •ë³´ë§Œ í™•ì¸í•´ì„œ í™˜ì˜ ë¬¸êµ¬ ì—…ë°ì´íŠ¸ (ë¦¬ë‹¤ì´ë ‰íŠ¸ ì—†ìŒ)
    (function(){
      const params = new URLSearchParams(location.search);
      if (params.get("code")) {
        // OAuth ì½”ë“œ êµí™˜ì´ ëë‚œ í›„ ensureLoggedInì´ ë‹¤ì‹œ í˜¸ì¶œë¨
        return;
      }
      window.ensureLoggedIn();
    })();

    /* ===== ë­í‚¹ ëª¨ë‹¬ ë¡œì§ ===== */

    const RANK_GAMES = [
      { slug:"2048",          label:"2048" },
      { slug:"brick-breaker", label:"Brick Breaker" },
      { slug:"retro-match",   label:"Retro Match" },
      { slug:"retro-running", label:"Retro Runner" },
      { slug:"tetris",        label:"Tetris" }
      // í•„ìš” ì‹œ brick-match ë“± ì¶”ê°€ ê°€ëŠ¥ (ìœ„ì—ì„œ alias ì²˜ë¦¬)
    ];

    let currentRankingGame = "2048";
    let rankModalInitialized = false;

    function mapGenderToLabel(g){
      if(!g) return "-";
      const s = String(g).toLowerCase();
      if(["m","male","ë‚¨","ë‚¨ì"].includes(s)) return "ë‚¨";
      if(["f","female","ì—¬","ì—¬ì"].includes(s)) return "ì—¬";
      return s;
    }

    function formatRankTime(value){
      if(!value) return "-";
      try{
        const d = new Date(value);
        if(!Number.isFinite(d.getTime())) return String(value);
        return d.toLocaleString("ko-KR");
      }catch(e){
        return String(value);
      }
    }

    function ensureRankTabs(){
      if(rankModalInitialized) return;
      const tabsWrap = document.getElementById("rankGameTabs");
      if(!tabsWrap) return;
      RANK_GAMES.forEach(game=>{
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "rank-game-tab";
        btn.setAttribute("data-game", game.slug);
        btn.setAttribute("role","tab");
        btn.innerHTML = `<span class="code">${game.label}</span><span>ë­í‚¹</span>`;
        btn.addEventListener("click", ()=>loadRanking(game.slug));
        tabsWrap.appendChild(btn);
      });
      rankModalInitialized = true;
    }

    function setActiveRankTab(slug){
      const tabsWrap = document.getElementById("rankGameTabs");
      if(!tabsWrap) return;
      [...tabsWrap.querySelectorAll(".rank-game-tab")].forEach(btn=>{
        const g = btn.getAttribute("data-game");
        if(g === slug) btn.classList.add("active");
        else btn.classList.remove("active");
      });
    }

    function renderRankingPlaceholder(){
      const body = document.getElementById("rankTableBody");
      const loading = document.getElementById("rankTableLoading");
      if(!body) return;
      body.innerHTML = "";
      const div = document.createElement("div");
      div.className = "rank-table-empty";
      div.textContent = "ë­í‚¹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
      body.appendChild(div);
      if(loading) loading.style.display = "none";
    }

    function renderRankingLoading(){
      const body = document.getElementById("rankTableBody");
      const loading = document.getElementById("rankTableLoading");
      if(!body) return;
      body.innerHTML = "";
      const div = loading || document.createElement("div");
      div.id = "rankTableLoading";
      div.className = "rank-table-loading";
      div.textContent = "ê²Œì„ ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...";
      body.appendChild(div);
    }

    function renderRanking(gameSlug, items){
      const body = document.getElementById("rankTableBody");
      if(!body) return;
      body.innerHTML = "";

      if(!items || !items.length){
        const empty = document.createElement("div");
        empty.className = "rank-table-empty";
        empty.textContent = "ì•„ì§ ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê²Œì„ì„ í”Œë ˆì´í•˜ê³  ìµœê³  ê¸°ë¡ì— ë„ì „í•´ ë³´ì„¸ìš”!";
        body.appendChild(empty);
        return;
      }

      items.slice(0,100).forEach((item, index)=>{
        const row = document.createElement("div");
        row.className = "rank-table-row";

        const rank = item.rank || (index+1);
        const userId = item.userId || item.user_id || item.username || "-";
        const gender = item.gender || item.sex || "-";
        const score = item.score != null ? item.score : (item.bestScore || item.value || 0);
        const points = item.points != null ? item.points : (item.rewardPoints || item.coins || 0);
        const time = item.achievedAt || item.achieved_at || item.updatedAt || item.updated_at || null;

        row.innerHTML = `
          <div class="rank-table-cell-rank">${rank}</div>
          <div class="rank-table-cell-user" title="${userId}">${userId}</div>
          <div class="rank-table-cell-gender">${mapGenderToLabel(gender)}</div>
          <div class="rank-table-cell-score">${fmt(score)}</div>
          <div class="rank-table-cell-points">${fmt(points)}</div>
          <div class="rank-table-cell-time" title="${formatRankTime(time)}">${formatRankTime(time)}</div>
        `;
        body.appendChild(row);
      });
    }

    async function loadRanking(slug){
      currentRankingGame = slug || currentRankingGame || "2048";
      ensureRankTabs();
      setActiveRankTab(currentRankingGame);

      const labelEl = document.getElementById("rankModalGameLabel");
      const gameMeta = RANK_GAMES.find(g=>g.slug===currentRankingGame);
      if(labelEl){
        labelEl.textContent = gameMeta ? `Â· ${gameMeta.label}` : "";
      }

      renderRankingLoading();

      const url = LEADERBOARD_API_BASE +
        "?game=" + encodeURIComponent(currentRankingGame) +
        "&limit=100";

      try{
        const res = await fetch(url, {
          method:"GET",
          headers:{
            "Accept":"application/json",
            "Cache-Control":"no-store"
          },
          credentials:"include"
        });

        if(!res.ok){
          // ì‹¤íŒ¨ ì‹œ ìƒ˜í”Œ ë”ë¯¸ ë°ì´í„°ë¼ë„ ë³´ì—¬ì¤Œ
          console.warn("leaderboard api error", res.status);
          renderRankingPlaceholder();
          return;
        }

        let data = null;
        try{
          data = await res.json();
        }catch(e){
          console.error("leaderboard json parse error", e);
        }

        let list = [];
        if(data){
          if(Array.isArray(data.items)) list = data.items;
          else if(Array.isArray(data.leaderboard)) list = data.leaderboard;
          else if(Array.isArray(data.data)) list = data.data;
        }

        // ë°±ì—”ë“œê°€ ì•„ì§ ì—†ì„ ê²½ìš° ëŒ€ë¹„ ë”ë¯¸ ì²˜ë¦¬
        if(!list || !list.length){
          renderRankingPlaceholder();
          return;
        }

        renderRanking(currentRankingGame, list);
      }catch(err){
        console.error("leaderboard fetch error", err);
        renderRankingPlaceholder();
      }
    }

    function openRankingModal(initialGame){
      const backdrop = document.getElementById("rankModalBackdrop");
      if(!backdrop) return;
      ensureRankTabs();
      backdrop.classList.add("open");
      backdrop.setAttribute("aria-hidden","false");

      // ì´ˆê¸° ê²Œì„: ì „ë‹¬ê°’ or ë§ˆì§€ë§‰ ê²Œì„ or ê¸°ë³¸ 2048
      if(initialGame) currentRankingGame = initialGame;
      loadRanking(currentRankingGame);

      // ESCë¡œ ë‹«ê¸°
      document.addEventListener("keydown", handleRankModalKeydown);
    }

    function closeRankingModal(){
      const backdrop = document.getElementById("rankModalBackdrop");
      if(!backdrop) return;
      backdrop.classList.remove("open");
      backdrop.setAttribute("aria-hidden","true");
      document.removeEventListener("keydown", handleRankModalKeydown);
    }

    function handleRankBackdropClick(e){
      const backdrop = document.getElementById("rankModalBackdrop");
      if(!backdrop) return;
      if(e.target === backdrop){
        closeRankingModal();
      }
    }

    function handleRankModalKeydown(e){
      if(e.key === "Escape"){
        closeRankingModal();
      }
    }

    // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ export
    window.openRankingModal = openRankingModal;
    window.closeRankingModal = closeRankingModal;

    // ë°±ë“œë¡­ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
    (function(){
      const backdrop = document.getElementById("rankModalBackdrop");
      if(backdrop){
        backdrop.addEventListener("click", handleRankBackdropClick);
      }
    })();

    /* ë°°ê²½ íŒŒí‹°í´ */
    const c=document.getElementById('fx');
    const g=c.getContext('2d');

    function fit(){
      const d=window.devicePixelRatio||1;
      c.width=innerWidth*d;
      c.height=innerHeight*d;
      g.setTransform(d,0,0,d,0,0);
    }
    fit();
    addEventListener('resize',fit);

    let pts=[];
    for(let i=0;i<80;i++){
      pts.push({
        x:Math.random()*innerWidth,
        y:Math.random()*innerHeight*0.9,
        r:Math.random()*2+0.5,
        s:Math.random()*0.6+0.2
      });
    }

    function loop(){
      g.clearRect(0,0,c.width,c.height);
      for(const p of pts){
        g.beginPath();
        g.arc(p.x,p.y,p.r,0,Math.PI*2);
        g.fillStyle=`rgba(43,123,255,${0.3+Math.sin(Date.now()*0.002+p.x)*0.25})`;
        g.fill();
        p.y+=p.s;
        if(p.y>innerHeight){
          p.y=-10;
          p.x=Math.random()*innerWidth;
        }
      }
      requestAnimationFrame(loop);
    }
    loop();

    /* ì™¸ë¶€ ì ë¦½ í˜¸ì¶œ ì˜ˆ */
    window.RG_addReward = addReward;
  </script>

  <div id="cookieBanner" class="cookie-banner" role="dialog" aria-live="polite" aria-label="Analytics consent">
    <div>ì„œë¹„ìŠ¤ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•œ ë¶„ì„(ì¿ í‚¤) ì‚¬ìš©ì— ë™ì˜í•˜ì‹œë‚˜ìš”?</div>
    <div class="spacer"></div>
    <button class="deny" type="button">ê±°ë¶€</button>
    <button class="agree" type="button">ë™ì˜</button>
  </div>

  <script>
    (function(){
      try{
        var KEY='rg_analytics_consent';
        function init(){ if(typeof window.analyticsInit==='function') window.analyticsInit(); }
        var v=null; try{ v=localStorage.getItem(KEY); }catch(e){}
        var el=document.getElementById('cookieBanner');
        if(v==='yes'){ init(); if(el) el.style.display='none'; return; }
        if(!el){ return; }
        el.style.display='flex';
        var agree=el.querySelector('.agree'), deny=el.querySelector('.deny');
        if(agree) agree.addEventListener('click', function(){
          try{ localStorage.setItem(KEY,'yes'); }catch(e){}
          el.style.display='none'; init();
        });
        if(deny) deny.addEventListener('click', function(){
          try{ localStorage.setItem(KEY,'no'); }catch(e){}
          el.style.display='none';
        });
      }catch(e){}
    })();
  </script>

  <!-- RG-OAUTH-CALLBACK-HANDLER -->
  <script>
    (function(){
      try{
        var params = new URLSearchParams(location.search);
        var code = params.get('code');
        if(!code) return;

        var state = params.get('state');
        var provider = (params.get('provider')||'').toLowerCase();
        if(!provider){
          provider = document.referrer.includes('naver') ? 'naver' : 'kakao';
        }

        // Cloudflare Pages Functions ê²½ë¡œë¡œ í†µì¼
        var endpoint = provider === 'naver'
          ? AUTH_API_BASE + '/oauth/naver/callback'
          : AUTH_API_BASE + '/oauth/kakao/callback';

        fetch(endpoint, {
          method: 'POST',
          headers: {
            'Content-Type':'application/json',
            'Cache-Control':'no-store'
          },
          credentials: 'include',
          body: JSON.stringify({ code: code, state: state })
        }).then(async function(r){
          var data = null;
          try{ data = await r.json(); }catch(e){}
          if(!r.ok || !data || !data.ok){
            console.error('OAuth callback failed', r.status, data);
            // ì‹¤íŒ¨í•´ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ìë™ ì´ë™í•˜ì§€ ì•ŠìŒ
            return;
          }
          // ì¿¼ë¦¬ ìŠ¤íŠ¸ë¦½
          history.replaceState({}, "", location.pathname);
          // ìœ ì € ì •ë³´ ë°˜ì˜
          if (typeof window.ensureLoggedIn === "function") {
            window.ensureLoggedIn();
          }
          try{
            console.log('ë¡œê·¸ì¸ ì™„ë£Œ:', data.user && (data.user.provider+': '+data.user.name));
          }catch(e){}
        }).catch(function(err){
          console.error('OAuth error', err);
          // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ìë™ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì—†ìŒ
        });
      }catch(e){}
    })();
  </script>

  <!--#include file="/partials/footer.html" -->
</body>
</html>
